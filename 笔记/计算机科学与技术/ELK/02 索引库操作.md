# 2	ç´¢å¼•åº“æ“ä½œ

## 2.1	mapping æ˜ å°„å±æ€§

#####  ç´¢å¼•åº“å’Œ mapping

ç´¢å¼•åº“ç›¸å½“äºæ•°æ®è¡¨ï¼Œè€Œ mapping æ˜ å°„ç›¸å½“äºè¡¨çš„ç»“æ„ï¼ˆDSLï¼‰ï¼Œæ˜¯å¯¹ç´¢å¼•åº“ä¸­æ–‡æ¡£çš„çº¦æŸã€‚

<br>

##### å¸¸è§çš„ mapping å±æ€§

- **type**ï¼šå­—æ®µæ•°æ®ç±»å‹ï¼Œå¸¸è§çš„ç®€å•ç±»å‹æœ‰ï¼š
  - **å­—ç¬¦ä¸²**ï¼štextï¼ˆå¯åˆ†è¯çš„æ–‡æœ¬ï¼‰ã€keywordï¼ˆç²¾ç¡®å€¼ï¼Œä¾‹å¦‚ï¼šå“ç‰Œã€å›½å®¶ã€ipåœ°å€ï¼‰
  - **æ•°å€¼**ï¼šlongã€integerã€shortã€byteã€doubleã€floatã€
  - **å¸ƒå°”**ï¼šboolean
  - **æ—¥æœŸ**ï¼šdate
  - **å¯¹è±¡**ï¼šobject
- **index**ï¼šæ˜¯å¦åˆ›å»ºç´¢å¼•ï¼Œé»˜è®¤ä¸ºtrue
- **analyzer**ï¼šä½¿ç”¨å“ªç§åˆ†è¯å™¨
- **properties**ï¼šè¯¥å­—æ®µçš„å­å­—æ®µ

<br>

##### ç¤ºä¾‹ â€”â€” mapping æ¼”ç¤º

ä¾‹å¦‚ä¸‹é¢çš„ json æ–‡æ¡£ï¼š

```json
{
Â Â Â Â "age":Â 21,
Â Â Â Â "weight":Â 52.1,
Â Â Â Â "isMarried":Â false,
Â Â Â Â "info":Â "é»‘é©¬ç¨‹åºå‘˜Javaè®²å¸ˆ",
    "email":Â "zy@itcast.cn",
    "score":Â [99.1, 99.5, 98.9],
Â Â Â Â "name":Â {
Â Â Â Â Â Â Â Â "firstName":Â "äº‘",
Â Â Â Â Â Â Â Â "lastName":Â "èµµ"
Â Â Â Â }
}
```

å¯¹åº”çš„æ¯ä¸ªå­—æ®µæ˜ å°„ï¼ˆmappingï¼‰ï¼š

- ageï¼šç±»å‹ä¸º integerï¼›å‚ä¸æœç´¢ï¼Œå› æ­¤éœ€è¦indexä¸ºtrueï¼›æ— éœ€åˆ†è¯å™¨
- weightï¼šç±»å‹ä¸ºfloatï¼›å‚ä¸æœç´¢ï¼Œå› æ­¤éœ€è¦indexä¸ºtrueï¼›æ— éœ€åˆ†è¯å™¨
- isMarriedï¼šç±»å‹ä¸ºbooleanï¼›å‚ä¸æœç´¢ï¼Œå› æ­¤éœ€è¦indexä¸ºtrueï¼›æ— éœ€åˆ†è¯å™¨
- infoï¼šç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œéœ€è¦åˆ†è¯ï¼Œå› æ­¤æ˜¯textï¼›å‚ä¸æœç´¢ï¼Œå› æ­¤éœ€è¦indexä¸ºtrueï¼›åˆ†è¯å™¨å¯ä»¥ç”¨ik_smart
- emailï¼šç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä¸éœ€è¦åˆ†è¯ï¼Œå› æ­¤æ˜¯keywordï¼›ä¸å‚ä¸æœç´¢ï¼Œå› æ­¤éœ€è¦indexä¸ºfalseï¼›æ— éœ€åˆ†è¯å™¨
- scoreï¼šè™½ç„¶æ˜¯æ•°ç»„ï¼Œä½†æ˜¯æˆ‘ä»¬åªçœ‹å…ƒç´ çš„ç±»å‹ï¼Œç±»å‹ä¸ºfloatï¼›å‚ä¸æœç´¢ï¼Œå› æ­¤éœ€è¦indexä¸ºtrueï¼›æ— éœ€åˆ†è¯å™¨
- nameï¼šç±»å‹ä¸ºobjectï¼Œéœ€è¦å®šä¹‰å¤šä¸ªå­å±æ€§
  - name.firstNameï¼›ç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä¸éœ€è¦åˆ†è¯ï¼Œå› æ­¤æ˜¯keywordï¼›å‚ä¸æœç´¢ï¼Œå› æ­¤éœ€è¦indexä¸ºtrueï¼›æ— éœ€åˆ†è¯å™¨
  - name.lastNameï¼›ç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä¸éœ€è¦åˆ†è¯ï¼Œå› æ­¤æ˜¯keywordï¼›å‚ä¸æœç´¢ï¼Œå› æ­¤éœ€è¦indexä¸ºtrueï¼›æ— éœ€åˆ†è¯å™¨

<br>

----

<div STYLE="page-break-after: always;">
    <br>
    <br>
    <br>
    <br>
    <br></div>

## 2.2	ç´¢å¼•åº“çš„ CRUD

### 2.2.0

##### ğŸ“Œæœ¬ç« èŠ‚ä¸­ç»Ÿä¸€ä½¿ç”¨ Kibana ç¼–å†™ DSL çš„æ–¹å¼æ¥æ¼”ç¤º

<br>

----

<div STYLE="page-break-after: always;">
    <br>
    <br>
    <br>
    <br>
    <br></div>
### 2.2.1	åˆ›å»ºç´¢å¼•åº“å’Œæ˜ å°„

##### Mysql æ•°æ®ç±»å‹ä¸ç´¢å¼•æ•°æ®ç±»å‹çš„å¯¹åº”å…³ç³»

| MySQLæ•°æ®ç±»å‹     | Elasticsearchæ•°æ®ç±»å‹ | è¯´æ˜                                                         |
| ----------------- | --------------------- | ------------------------------------------------------------ |
| tinyint           | short                 |                                                              |
| unsigned tinyint  | integer               |                                                              |
| mediumint         | integer               | -/-                                                          |
| smallint          | short                 |                                                              |
| unsigned smallint | integer               |                                                              |
| int               | integer               |                                                              |
| unsigned int      | long                  |                                                              |
| bigint            | long                  | -/-                                                          |
|                   | Bool                  |                                                              |
| Boolean           | boolean               | -/-                                                          |
| decimal           | double                | å¦‚æœdecimalåé¢å¸¦å°æ•°ç‚¹ï¼ŒElasticsearch 6.7.1ä»¥ä¸‹ç”¨textç±»å‹ï¼Œ6.7.1ä»¥ä¸Šç”¨BigDecimal |
| double            | double                | -/-                                                          |
| float             | float                 | -/-                                                          |
| char              | text                  | -/-                                                          |
| varchar           | text                  | -/-                                                          |
| longtext          | text                  | -/-                                                          |
| mediumtext        | text                  | -/-                                                          |
| tinytext          | text                  | -/-                                                          |
| blob              | binary                | -/-                                                          |
| binary            | binary                | -/-                                                          |
| bit               | long                  | bit(1)â€“&gt;boolean                                           |
| Date              | date                  | Elaticsearché»˜è®¤æ ¼å¼ï¼šyyyy-MM-ddã€‚                           |
| datetime          | date                  | Elaticsearché»˜è®¤æ ¼å¼ï¼šyyyy-MM-ddâ€™Tâ€™HH:mm:ssï¼Œå¦‚å«å¾®ç§’ç²¾åº¦date_formatä¸º yyyy-MM-ddâ€™Tâ€™HH:mm:ss.Sã€‚ |
| timestamp         | date                  | Elaticsearché»˜è®¤æ ¼å¼ï¼šyyyy-MM-ddâ€™Tâ€™HH:mm:ssï¼Œå¦‚å«å¾®ç§’ç²¾åº¦date_formatä¸º yyyy-MM-ddâ€™Tâ€™HH:mm:ss.S ã€‚ |
| time              | date                  | Elaticsearché»˜è®¤æ ¼å¼ï¼šHH:mm:ss,å¦‚å«å¾®ç§’ç²¾åº¦date_formatä¸º HH:mm:ss.Sã€‚ |
| year              | date                  | Elaticsearché»˜è®¤æ ¼å¼ï¼šyyyy                                   |

##### åŸºæœ¬è¯­æ³•

- **è¯·æ±‚æ–¹å¼**ï¼šPUT
- **è¯·æ±‚è·¯å¾„**ï¼š/ç´¢å¼•åº“åï¼Œå¯ä»¥è‡ªå®šä¹‰
- **è¯·æ±‚å‚æ•°**ï¼šmapping æ˜ å°„

<br>

##### æ ¼å¼

```json
PUTÂ /ç´¢å¼•åº“åç§°
{
Â Â "mappings":Â {
Â Â Â Â "properties":Â {
Â Â Â Â Â Â "å­—æ®µå":{
Â Â Â Â Â Â Â Â "type":Â "text",
Â Â Â Â Â Â Â Â "analyzer":Â "ik_smart"
Â Â Â Â Â Â },
Â Â Â Â Â Â "å­—æ®µå2":{
Â Â Â Â Â Â Â Â "type":Â "keyword",
Â Â Â Â Â Â Â Â "index":Â "false"
Â Â Â Â Â Â },
Â Â Â Â Â Â "å­—æ®µå3":{
Â Â Â Â Â Â Â Â "properties":Â {
Â Â Â Â Â Â Â Â Â Â "å­å­—æ®µ":Â {
Â Â Â Â Â Â Â Â Â Â Â Â "type":Â "keyword"
Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â },
      // ...ç•¥
Â Â Â Â }
Â Â }
}
```

<br>

##### ç¤ºä¾‹

```json
PUT /index_library_demo
{
  "mappings": {
    "properties": {
      "info":{
        "type":"text",
        "analyzer":"ik_smart"
      },
      "email":{
        "type":"text",
        "index":"false"
      },
      "name":{
        "properties":{
          "firstName":{
            "type":"keyword"
          },
          "lastName":{
            "type":"keyword"
          }
          }
      }
    }
  }
}
```

<br>

---

<div STYLE="page-break-after: always;">
    <br>
    <br>
    <br>
    <br>
    <br></div>

### 2.2.2	æŸ¥è¯¢ç´¢å¼•åº“

##### åŸºæœ¬è¯­æ³•

- è¯·æ±‚æ–¹å¼ï¼šGET
- è¯·æ±‚è·¯å¾„ï¼š/ç´¢å¼•åº“å
- è¯·æ±‚å‚æ•°ï¼šæ— 

<br>

##### æ ¼å¼

```
GET /ç´¢å¼•åº“å
```

<br>

##### ç¤ºä¾‹

![](img/2.2.2-1.png)

<br>

---

<div STYLE="page-break-after: always;">
    <br>
    <br>
    <br>
    <br>
    <br></div>

### 2.2.3	ä¿®æ”¹ç´¢å¼•åº“

##### ğŸ“Œmapping æ— æ³•ä¿®æ”¹å·²æœ‰å­—æ®µ

å€’æ’ç´¢å¼•ç»“æ„è™½ç„¶ä¸å¤æ‚ï¼Œä½†æ˜¯ä¸€æ—¦æ•°æ®ç»“æ„æ”¹å˜ï¼ˆæ¯”å¦‚æ”¹å˜äº†åˆ†è¯å™¨ï¼‰ï¼Œå°±éœ€è¦é‡æ–°åˆ›å»ºå€’æ’ç´¢å¼•ï¼Œè¿™ç®€ç›´æ˜¯ç¾éš¾ã€‚å› æ­¤ç´¢å¼•åº“ **ä¸€æ—¦åˆ›å»ºï¼Œæ— æ³•ä¿®æ”¹mapping**ã€‚

<br>

##### mapping è¿è¡Œæ·»åŠ æ–°çš„å­—æ®µ

è™½ç„¶æ— æ³•ä¿®æ”¹ mapping ä¸­å·²æœ‰çš„å­—æ®µï¼Œä½†æ˜¯å´å…è®¸æ·»åŠ æ–°çš„å­—æ®µåˆ° mapping ä¸­ï¼Œå› ä¸ºä¸ä¼šå¯¹å€’æ’ç´¢å¼•äº§ç”Ÿå½±å“ã€‚

<br>

##### è¯­æ³•

```json
PUTÂ /ç´¢å¼•åº“å/_mapping
{
Â Â "properties":Â {
Â Â Â Â "æ–°å­—æ®µå":{
Â Â Â Â Â Â "type":Â "integer"
Â Â Â Â }
Â Â }
}
```

<br>

---

<div STYLE="page-break-after: always;">
    <br>
    <br>
    <br>
    <br>
    <br></div>

### 2.2.4.åˆ é™¤ç´¢å¼•åº“

##### è¯­æ³•

- è¯·æ±‚æ–¹å¼ï¼šDELETE
- è¯·æ±‚è·¯å¾„ï¼š/ç´¢å¼•åº“å
- è¯·æ±‚å‚æ•°ï¼šæ— 

<br>

##### æ ¼å¼

```
DELETE /ç´¢å¼•åº“å
```

<br>

##### æµ‹è¯•

![](img/2.2.4-1.png)

---

<div STYLE="page-break-after: always;">
    <br>
    <br>
    <br>
    <br>
    <br></div>
