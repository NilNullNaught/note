# 分布式数据库设计

##### 数据库设计规约

###### 数据库命名

库名与应用名称尽量一致。

###### 表与字段命名

表名、字段名必须使用小写字母或数字，禁止出现数字开头，表名不使用复数名词。

表的命名最好是加上“业务名称_表的作用”。如，edu_teacher。

###### 使用 is_xxx 的方式命名表达是与否的字段

表达是与否概念的字段，必须使用 is_xxx 的方式命名，数据类型是 unsigned tinyint （1 表示是，0 表示否）。 

- 说明：任何字段如果为非负数，必须是 unsigned。 
- 注意：POJO 类中的任何布尔类型的变量，都不要加 is 前缀。数据库表示是与否的值，使用 tinyint 类型，并且坚持 is_xxx 的 命名方式是为了明确其取值含义与取值范围。 
- 正例：表达逻辑删除的字段名 is_deleted，1 表示删除，0 表示未删除。 

###### 表必备的三个字段

id, gmt_create, gmt_modified：

- 其中 id 必为主键，类型为 bigint unsigned、单表时自增、步长为 1。（如果使用分库分表集群部署，则 id 类型为 verchar，非自增，业务中使用分布式id生成器）
- gmt_create, gmt_modified 的类型均为 datetime 类型，前者现在时表示主动创建，后者过去分词表示被 动更新。

###### 进行分库分表的前提条件

 如果预计三年后的数据量达单表行数超过 500 万行或者单表容量超过 2GB，才推荐进行分库分表。达不到，请不要在创建表时就分库分表。 

###### 小数字段的类型设置为 decimal

小数类型为 decimal，禁止使用 float 和 double。 

**说明**：float 和 double 在存储的时候，存在精度损失的问题，很可能在值的比较时，得到不 正确的结果。如果存储的数据范围超过 decimal 的范围，建议将数据拆成整数和小数分开存储。

###### 存储长度恒定的字符串使用 char 定长字符串类型

如果存储的字符串长度几乎相等，使用 char 定长字符串类型。 

###### 长文本字段的类型设置

varchar 是可变长字符串，不预先分配存储空间，长度不要超过 5000，如果存储长度大于此值，定义字段类型为 text，独立出来一张表，用主键来对应，避免影响其它字段索 引效率。

###### 索引命名

唯一索引名为 `uk_字段名`；普通索引名则为 `idx_字段名`。

**说明**：uk_ 即 unique key；idx_ 即 index 的简称

###### 不得使用外键与级联

不得使用外键与级联，一切外键概念必须在应用层解决。外键与级联更新适用于单机低并发，不适合分布式、高并发集群；级联更新是强阻塞，存在数据库更新风暴的风险；外键影响数据库的插入速度。 

<br>

##### 参考资料《阿里巴巴 Java 开发手册》

<br>

----

<div STYLE="page-break-after: always;">
    <br>
	<br>
	<br>
	<br>
	<br>
</div>
