# å¾®æœåŠ¡å·¥ç¨‹æ„å»º

## 1	åŸºæœ¬é¡¹ç›®æ„å»º

##### ä¸€èˆ¬å¾®æœåŠ¡çš„å·¥ç¨‹ç»“æ„

![img](img/592a017b-f501-4359-b92f-8b75875c45f7.png)

**guli-parentï¼šæ ¹ç›®å½•ï¼ˆçˆ¶å·¥ç¨‹ï¼‰ï¼Œç®¡ç†å››ä¸ªå­æ¨¡å—ï¼š**

- **canal-clientï¼šcanalæ•°æ®åº“è¡¨åŒæ­¥æ¨¡å—ï¼ˆç»Ÿè®¡åŒæ­¥æ•°æ®ï¼‰**

- **common**ï¼šå…¬å…±æ¨¡å—çˆ¶èŠ‚ç‚¹
  - **common-util**ï¼šå·¥å…·ç±»æ¨¡å—ï¼Œæ‰€æœ‰æ¨¡å—éƒ½å¯ä»¥ä¾èµ–äºå®ƒã€‚
  - **service-base**ï¼šservice æœåŠ¡çš„ base åŒ…ï¼ŒåŒ…å« service æœåŠ¡çš„å…¬å…±é…ç½®ç±»ï¼Œæ‰€æœ‰ service æ¨¡å—ä¾èµ–äºå®ƒ
  - **spring-security**ï¼šè®¤è¯ä¸æˆæƒæ¨¡å—ï¼Œéœ€è¦è®¤è¯æˆæƒçš„ service æœåŠ¡ä¾èµ–äºå®ƒ

- **infrastructure**ï¼šåŸºç¡€æœåŠ¡æ¨¡å—çˆ¶èŠ‚ç‚¹ã€‚

  - **api-gateway**ï¼šapiç½‘å…³æœåŠ¡

- **service**ï¼šapi æ¥å£æœåŠ¡çš„çˆ¶èŠ‚ç‚¹ï¼ŒåŒ…å«é¡¹ç›®ä¸»è¦çš„å¾®æœåŠ¡æ¨¡å—

  <br>

##### åˆ›å»ºçˆ¶å·¥ç¨‹

###### ç¬¬ä¸€æ­¥

åœ¨ idea å¼€å‘å·¥å…·ä¸­ï¼Œä½¿ç”¨ Spring Initializr å¿«é€Ÿåˆå§‹åŒ–ä¸€ä¸ª Spring Boot æ¨¡å—ã€‚

###### ç¬¬äºŒæ­¥

åˆ é™¤ src ç›®å½•ã€‚

###### ç¬¬ä¸‰æ­¥

åœ¨ artifactId æ¥å£åå°†æ‰“åŒ…ç±»å‹è®¾ç½®ä¸º pomï¼ˆé»˜è®¤ä¸º pomï¼Œä¸€èˆ¬ä¸éœ€è¦è®¾ç½®ï¼‰ã€‚

```
<artifactId>xxx</artifactId>
<packaging>pom</packaging>
```

###### ç¬¬å››æ­¥

åˆ é™¤ pom.xml ä¸­çš„ \<dependencies> å†…å®¹ï¼š

```
    <!-- ä»¥ä¸‹å†…å®¹åˆ é™¤ -->
    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter</artifactId>
        </dependency>

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
    </dependencies>
```

###### ç¬¬äº”æ­¥

ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <modules>
        <module>service</module>
    </modules>

    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.3.12.RELEASE</version>
        <relativePath/> <!-- lookup parent from repository -->
    </parent>

    <groupId>cn.nilnullnaught</groupId>
    <artifactId>nnnnote</artifactId>
    <packaging>pom</packaging>
    <version>0.0.1-SNAPSHOT</version>
    <name>nnnnote</name>
    <description>nnnnote</description>

    <properties>
        <java.version>11</java.version>
        <nnnnnote.version>0.0.1-SNAPSHOT</nnnnnote.version>
        <cloud-alibaba.version>2.2.7.RELEASE</cloud-alibaba.version>
        <mybatis-plus.version>3.5.0</mybatis-plus.version>
        <velocity.version>2.0</velocity.version>
        <springdoc-openapi-ui.version>1.6.4</springdoc-openapi-ui.version>
        <jjwt.version>0.7.0</jjwt.version>
        <commons-dbutils.version>1.7</commons-dbutils.version>
        <commons-fileupload.version>1.3.1</commons-fileupload.version>
        <commons-io.version>2.6</commons-io.version>
        <httpclient.version>4.5.1</httpclient.version>
        <canal.client.version>1.1.0</canal.client.version>
        <docker.image.prefix>zx</docker.image.prefix>
        <junit.version>4.12</junit.version>

        <aliyun.oss.version>2.8.3</aliyun.oss.version>
        <aliyun-java-sdk-core.version>4.3.3</aliyun-java-sdk-core.version>
        <aliyun-sdk-oss.version>3.1.0</aliyun-sdk-oss.version>
        <aliyun-java-sdk-vod.version>2.15.2</aliyun-java-sdk-vod.version>
        <aliyun-java-vod-upload.version>1.4.11</aliyun-java-vod-upload.version>
        <aliyun-sdk-vod-upload.version>1.4.11</aliyun-sdk-vod-upload.version>
        <fastjson.version>1.2.28</fastjson.version>
        <gson.version>2.8.2</gson.version>
        <json.version>20170516</json.version>

        <jodatime.version>2.10.1</jodatime.version>
        <poi.version>3.17</poi.version>
    </properties>


    <dependencyManagement>
        <dependencies>
            <!--Spring Cloud-->
            <dependency>
                <groupId>org.springframework.cloud</groupId>
                <artifactId>spring-cloud-dependencies</artifactId>
                <version>Hoxton.SR12</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>

            <dependency>
                <groupId>com.alibaba.cloud</groupId>
                <artifactId>spring-cloud-alibaba-dependencies</artifactId>
                <version>${cloud-alibaba.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>

            <!--mybatis-plus æŒä¹…å±‚-->
            <dependency>
                <groupId>com.baomidou</groupId>
                <artifactId>mybatis-plus-boot-starter</artifactId>
                <version>${mybatis-plus.version}</version>
            </dependency>

            <!-- velocity æ¨¡æ¿å¼•æ“, Mybatis Plus ä»£ç ç”Ÿæˆå™¨éœ€è¦ -->
            <dependency>
                <groupId>org.apache.velocity</groupId>
                <artifactId>velocity-engine-core</artifactId>
                <version>${velocity.version}</version>
            </dependency>

            <!-- springdocï¼Œå¸®åŠ©ä½¿ç”¨è€…å°† swagger3 é›†æˆåˆ° Spring ä¸­ -->
            <dependency>
                <groupId>org.springdoc</groupId>
                <artifactId>springdoc-openapi-ui</artifactId>
                <version>${springdoc-openapi-ui.version}</version>
            </dependency>

            <!-- java JWT -->
            <dependency>
                <groupId>io.jsonwebtoken</groupId>
                <artifactId>jjwt</artifactId>
                <version>${jjwt.version}</version>
            </dependency>

            <!--commons-dbutils-->
            <dependency>
                <groupId>commons-dbutils</groupId>
                <artifactId>commons-dbutils</artifactId>
                <version>${commons-dbutils.version}</version>
            </dependency>

            <!--æ–‡ä»¶ä¸Šä¼ -->
            <dependency>
                <groupId>commons-fileupload</groupId>
                <artifactId>commons-fileupload</artifactId>
                <version>${commons-fileupload.version}</version>
            </dependency>

            <!--commons-io-->
            <dependency>
                <groupId>commons-io</groupId>
                <artifactId>commons-io</artifactId>
                <version>${commons-io.version}</version>
            </dependency>

            <!--httpclient-->
            <dependency>
                <groupId>org.apache.httpcomponents</groupId>
                <artifactId>httpclient</artifactId>
                <version>${httpclient.version}</version>
            </dependency>

            <!-- canal -->
            <dependency>
                <groupId>com.alibaba.otter</groupId>
                <artifactId>canal.client</artifactId>
                <version>${canal.client.version}</version>
            </dependency>

            <!-- junit -->
            <dependency>
                <groupId>junit</groupId>
                <artifactId>junit</artifactId>
                <version>${junit.version}</version>
            </dependency>



            <!--aliyunOSS-->
            <dependency>
                <groupId>com.aliyun.oss</groupId>
                <artifactId>aliyun-sdk-oss</artifactId>
                <version>${aliyun.oss.version}</version>
            </dependency>
            <!--aliyun-->
            <dependency>
                <groupId>com.aliyun</groupId>
                <artifactId>aliyun-java-sdk-core</artifactId>
                <version>${aliyun-java-sdk-core.version}</version>
            </dependency>
            <dependency>
                <groupId>com.aliyun.oss</groupId>
                <artifactId>aliyun-sdk-oss</artifactId>
                <version>${aliyun-sdk-oss.version}</version>
            </dependency>
            <dependency>
                <groupId>com.aliyun</groupId>
                <artifactId>aliyun-java-sdk-vod</artifactId>
                <version>${aliyun-java-sdk-vod.version}</version>
            </dependency>
            <dependency>
                <groupId>com.aliyun</groupId>
                <artifactId>aliyun-java-vod-upload</artifactId>
                <version>${aliyun-java-vod-upload.version}</version>
            </dependency>
            <dependency>
                <groupId>com.aliyun</groupId>
                <artifactId>aliyun-sdk-vod-upload</artifactId>
                <version>${aliyun-sdk-vod-upload.version}</version>
            </dependency>
            <dependency>
                <groupId>com.alibaba</groupId>
                <artifactId>fastjson</artifactId>
                <version>${fastjson.version}</version>
            </dependency>
            <dependency>
                <groupId>org.json</groupId>
                <artifactId>json</artifactId>
                <version>${json.version}</version>
            </dependency>
            <dependency>
                <groupId>com.google.code.gson</groupId>
                <artifactId>gson</artifactId>
                <version>${gson.version}</version>
            </dependency>


            <!--æ—¥æœŸæ—¶é—´å·¥å…·-->
            <dependency>
                <groupId>joda-time</groupId>
                <artifactId>joda-time</artifactId>
                <version>${jodatime.version}</version>
            </dependency>
            <!--xls-->
            <dependency>
                <groupId>org.apache.poi</groupId>
                <artifactId>poi</artifactId>
                <version>${poi.version}</version>
            </dependency>
            <!--xlsx-->
            <dependency>
                <groupId>org.apache.poi</groupId>
                <artifactId>poi-ooxml</artifactId>
                <version>${poi.version}</version>
            </dependency>
        </dependencies>


    </dependencyManagement>

    <build>
        <resources>
            <resource>
                <directory>src/main/java</directory>
                <includes>
                    <include>**/*.xml</include>
                </includes>
                <filtering>false</filtering>
            </resource>
        </resources>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
            </plugin>
        </plugins>
    </build>

</project>

```

<br>

##### åˆ›å»º service æ¨¡å—

###### ç¬¬ä¸€æ­¥

åœ¨çˆ¶å·¥ç¨‹ä¸‹åˆ›å»ºå­æ¨¡å— serviceï¼Œé€‰æ‹© maven ç±»å‹ã€‚

###### ç¬¬äºŒæ­¥

å°† service æ¨¡å—çš„æ‰“åŒ…ç±»å‹è®¾ç½®ä¸º pomï¼Œå³åœ¨ \<artifactId> èŠ‚ç‚¹åæ·»åŠ ä»¥ä¸‹å±æ€§ï¼š

```
	...
	
    <artifactId>service</artifactId>
    <!-- å°†æ‰“åŒ…ç±»å‹è®¾ç½®ä¸º pom -->
    <packaging>pom</packaging>
	...
```

###### ç¬¬ä¸‰æ­¥

åœ¨ service æ¨¡å—çš„ pom.xml æ–‡ä»¶ä¸‹æ·»åŠ å„ä¸ªå¾®æœåŠ¡å­æ¨¡å—çš„å…¬å…±ä¾èµ–

```xml
<dependencies>
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-netflix-ribbon</artifactId>
    </dependency>

    <!--hystrixä¾èµ–ï¼Œä¸»è¦æ˜¯ç”¨  @HystrixCommand -->
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-netflix-hystrix</artifactId>
    </dependency>

    <!--æœåŠ¡æ³¨å†Œ-->
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
    </dependency>
    <!--æœåŠ¡è°ƒç”¨-->
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-openfeign</artifactId>
    </dependency>

    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>

    <!--mybatis-plus-->
    <dependency>
        <groupId>com.baomidou</groupId>
        <artifactId>mybatis-plus-boot-starter</artifactId>
    </dependency>

    <!--mysql-->
    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
    </dependency>

    <!-- velocity æ¨¡æ¿å¼•æ“, Mybatis Plus ä»£ç ç”Ÿæˆå™¨éœ€è¦ -->
    <dependency>
        <groupId>org.apache.velocity</groupId>
        <artifactId>velocity-engine-core</artifactId>
    </dependency>

    <!-- springdocï¼Œå¸®åŠ©ä½¿ç”¨è€…å°† swagger3 é›†æˆåˆ° Spring ä¸­ -->
    <dependency>
		<groupId>org.springdoc</groupId>
		<artifactId>springdoc-openapi-ui</artifactId>
    </dependency>

    <!--xls-->
    <dependency>
        <groupId>org.apache.poi</groupId>
        <artifactId>poi</artifactId>
    </dependency>

    <dependency>
        <groupId>org.apache.poi</groupId>
        <artifactId>poi-ooxml</artifactId>
    </dependency>

    <dependency>
        <groupId>commons-fileupload</groupId>
        <artifactId>commons-fileupload</artifactId>
    </dependency>

    <!--httpclient-->
    <dependency>
        <groupId>org.apache.httpcomponents</groupId>
        <artifactId>httpclient</artifactId>
    </dependency>
    
    <!--commons-io-->
    <dependency>
        <groupId>commons-io</groupId>
        <artifactId>commons-io</artifactId>
    </dependency>
   

    <dependency>
        <groupId>junit</groupId>
        <artifactId>junit</artifactId>
    </dependency>
</dependencies>
```

<br>

##### åœ¨ Service ä¸‹åˆ›å»ºå¾®æœåŠ¡å­æ¨¡å—

###### åˆ›å»ºå¾®æœåŠ¡å­æ¨¡å—

åœ¨ service æ¨¡å—ä¸‹åˆ›å»º service å­æ¨¡å— service-moduleï¼Œé€‰æ‹© maven ç±»å‹ã€‚

###### é…ç½®æ–‡ä»¶

application.yml

```yaml
server:
  port: 8001 #é…ç½®ç«¯å£å·

# mybatis-plus é…ç½®
mybatis-plus:
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl # mybatis-plus æ—¥å¿—
  mapper-locations: classpath:cn/nilnullnaught/service/*/mapper/*.xml
  global-config:
    db-config:
      logic-delete-value: 1
      logic-not-delete-value: 0

spring:
  application:
    name: service-test #é…ç½®æœåŠ¡å
  #æ•°æ®åº“é…ç½®
  datasource:
    type: com.zaxxer.hikari.HikariDataSource #ä½¿ç”¨ Hikari æ•°æ®åº“è¿æ¥æ± 
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://8.131.72.52:3306/shirotest?useSSL=false&serverTimezone=Asia/Shanghai&allowMultiQueries=true
    username: Outsider
    password: PASSWORDis1024
    hikari:
      minimum-idle: 10  
      maximum-pool-size: 100
      auto-commit: true
      idle-timeout: 30000
      pool-name: NNNnoteHikariPool
      max-lifetime: 180000
      connection-timeout: 30000
      connection-test-query: SELECT 1
      time-zone: GMT+8
  # redis é…ç½®
  redis:
    host: 8.131.72.52
    port: 6379
    password: PASSWORDis1024
    database: 0
    lettuce:
      pool:
        max-active: 20
        max-wait: -1
        max-idle: 8
        min-idle: 0
      shutdown-timeout: 100
    timeout: 10000
  # ç»Ÿä¸€è¿”å›çš„ json æ—¶é—´æ ¼å¼
  jackson:
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: GMT+8 #é»˜è®¤æƒ…å†µä¸‹jsonæ—¶é—´æ ¼å¼å¸¦æœ‰æ—¶åŒºï¼Œå¹¶ä¸”æ˜¯ä¸–ç•Œæ ‡å‡†æ—¶é—´ï¼Œå’Œæˆ‘ä»¬çš„æ—¶é—´å·®äº†å…«ä¸ªå°æ—¶
```

###### åˆ›å»º SpringBoot å¯åŠ¨ç±»

```java
package cn.nilnullnaught.nnnnote.user;

@SpringBootApplication
//springboot é¡¹ç›®å¯åŠ¨æ—¶ï¼Œå¦‚æœæ²¡æœ‰é…ç½®æ•°æ®åº“é…ç½®ï¼Œå¯åŠ¨æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œ

//å¦‚æœè¯¥æ¨¡å—ä¸éœ€è¦ä½¿ç”¨æ•°æ®åº“ï¼Œé‚£ä¹ˆä½¿ç”¨ä»¥ä¸‹é…ç½®é˜²æ­¢å¼‚å¸¸å‡ºç°
	//spring boot ä¼šé»˜è®¤åŠ è½½org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration è¿™ä¸ªç±»ï¼Œ
	//è€Œ DataSourceAutoConfiguration ç±»ä½¿ç”¨äº† @Configuration æ³¨è§£å‘ spring æ³¨å…¥äº† dataSource beanï¼Œ
	//åˆå› ä¸ºé¡¹ç›®ï¼ˆossæ¨¡å—ï¼‰ä¸­å¹¶æ²¡æœ‰å…³äº dataSource ç›¸å…³çš„é…ç½®ä¿¡æ¯ï¼Œæ‰€ä»¥å½“ spring åˆ›å»º dataSource bean æ—¶å› ç¼ºå°‘ç›¸å…³çš„ä¿¡æ¯å°±ä¼šæŠ¥é”™ã€‚
//@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)

@ComponentScan("cn.nilnullnaught.nnnnote")
@EnableFeignClients //å¼€å¯ Feign åŠŸèƒ½
@MapperScan("cn.nilnullnaught.nnnnote.user.mapper")
//spring cloud ä» Edgware ç‰ˆæœ¬å¼€å§‹ï¼Œåªè¦é…ç½®å¥½æ³¨å†Œä¸­å¿ƒçš„ç›¸å…³é…ç½®å³å¯è‡ªåŠ¨å¼€å¯æœåŠ¡æ³¨å†ŒåŠŸèƒ½
//@EnableDiscoveryClient
public class Application {

	public static void main(String[] args) {
		SpringApplication.run(Application.class, args);
	}
}
```

<br>

<br>

##### åˆ›å»º common æ¨¡å—

###### ç¬¬ä¸€æ­¥

åœ¨çˆ¶å·¥ç¨‹ä¸‹åˆ›å»º maven æ¨¡å— commonã€‚

###### ç¬¬äºŒæ­¥

åœ¨ common ä¸­å¼•å…¥ä¾èµ–ï¼š

```xml
<dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
            <scope>provided </scope>
        </dependency>

        <!--mybatis-plus-->
        <dependency>
            <groupId>com.baomidou</groupId>
            <artifactId>mybatis-plus-boot-starter</artifactId>
            <scope>provided </scope>
        </dependency>

        <!--lombokç”¨æ¥ç®€åŒ–å®ä½“ç±»ï¼šéœ€è¦å®‰è£…lombokæ’ä»¶-->
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <scope>provided</scope>
        </dependency>

    <!-- springdocï¼Œå¸®åŠ©ä½¿ç”¨è€…å°† swagger3 é›†æˆåˆ° Spring ä¸­ -->
    <dependency>
		<groupId>org.springdoc</groupId>
		<artifactId>springdoc-openapi-ui</artifactId>
    </dependency>

        <!-- redis -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-redis</artifactId>
        </dependency>

        <!-- spring2.Xé›†æˆredisæ‰€éœ€common-pool2
        <dependency>
            <groupId>org.apache.commons</groupId>
            <artifactId>commons-pool2</artifactId>
            <version>2.6.0</version>
        </dependency>-->
    </dependencies>

	<!-- å¯¹äºæ²¡æœ‰ main() çš„å·¥å…·åŒ…ï¼ˆæ¯”å¦‚ common åŒ…ï¼‰ï¼Œæ‰“åŒ…æ—¶ä¼šå‡ºç° Unable to find main class é”™è¯¯ï¼Œ éœ€è¦åœ¨ pom.xml æ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹é…ç½® -->
    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <version>2.3.2.RELEASE</version>
                <configuration>
                    <layout>NONE</layout>
                </configuration>
            </plugin>
        </plugins>
    </build>
```

<br>

##### åˆ›å»º common çš„å­æ¨¡å— service-base

åœ¨è¯¥æ¨¡å—ä¸‹åˆ›å»ºåŒ… cn.nilnullnaught.servicebase

<br>

##### åˆ›å»º common çš„å­æ¨¡å— common-utils

åœ¨è¯¥æ¨¡å—ä¸‹åˆ›å»ºåŒ… cn.nilnullnaught.commonutils

<br>

#### ğŸ“Œè§£å†³ Mybatis çš„ xml æ–‡ä»¶ä¸èƒ½éšç€ç¼–è¯‘è‡ªåŠ¨ç”Ÿæˆé—®é¢˜

###### åŸå› 

é»˜è®¤æƒ…å†µä¸‹ï¼Œmaven å·¥ç¨‹åœ¨ src/main/java ç›®å½•ä¸‹çš„æ‰€æœ‰èµ„æºæ–‡ä»¶æ˜¯ä¸å‘å¸ƒåˆ° target ç›®å½•ä¸‹çš„ã€‚

###### è§£å†³æ–¹æ¡ˆä¸€

1. åœ¨çˆ¶å·¥ç¨‹çš„ pom.xml æ–‡ä»¶ä¸­é…ç½®å¦‚ä¸‹èŠ‚ç‚¹ï¼š

```
<!-- é¡¹ç›®æ‰“åŒ…æ—¶ä¼šå°†javaç›®å½•ä¸­çš„*.xmlæ–‡ä»¶ä¹Ÿè¿›è¡Œæ‰“åŒ… -->
<build>
    <resources>
        <resource>
            <directory>src/main/java</directory>
            <includes>
                <include>**/*.xml</include>
            </includes>
            <filtering>false</filtering>
        </resource>
    </resources>
</build>
```

2. åœ¨ Spring Boot é…ç½®æ–‡ä»¶ä¸­æ·»åŠ é…ç½®

```
#é…ç½®mapper xmlæ–‡ä»¶çš„è·¯å¾„
mybatis-plus.mapper-locations=classpath:cn/nilnullnaught/*/mapper/xml/*.xml
```

<br>


---

<div STYLE="page-break-after: always;">
    <br>
	<br>
	<br>
	<br>
	<br>
</div>
## 2	ä½¿ç”¨ä»£ç ç”Ÿæˆå™¨

### 2.1	Mybatisplus ä»£ç ç”Ÿæˆå™¨ï¼ˆæ—§ï¼‰

##### åˆ›å»ºä»£ç ç”Ÿæˆå™¨

###### å‰ææ¡ä»¶

å·²ç»å¯¼å…¥ mybatisplus ä¾èµ–ã€‚

###### ç”Ÿæˆå™¨ä»£ç 

åœ¨ test/java ç›®å½•ä¸‹åˆ›å»ºåŒ…com.atguigu.eduserviceï¼Œåˆ›å»ºä»£ç ç”Ÿæˆå™¨ï¼š`CodeGenerator.java`

```java
package cn.nilnullnaught.eduservice;

import com.baomidou.mybatisplus.annotation.DbType;
import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.generator.AutoGenerator;
import com.baomidou.mybatisplus.generator.config.DataSourceConfig;
import com.baomidou.mybatisplus.generator.config.GlobalConfig;
import com.baomidou.mybatisplus.generator.config.PackageConfig;
import com.baomidou.mybatisplus.generator.config.StrategyConfig;
import com.baomidou.mybatisplus.generator.config.rules.DateType;
import com.baomidou.mybatisplus.generator.config.rules.NamingStrategy;
import org.junit.Test;

public class CodeGenerator {
    public class getCode {
        @Test
        public void main1() {
            // 1ã€åˆ›å»ºä»£ç ç”Ÿæˆå™¨
            AutoGenerator mpg = new AutoGenerator();
            // 2ã€å…¨å±€é…ç½®
            GlobalConfig gc = new GlobalConfig();
            String projectPath = System.getProperty("user.dir");
            System.out.println(projectPath);
            //å»ºè®®ä¿®æ”¹ï¼Œå°† projectPath æ‰‹åŠ¨æ›¿æ¢ä¸ºé¡¹ç›®çš„ç»å¯¹è·¯å¾„
            gc.setOutputDir(projectPath + "/src/main/java");
            //éœ€è¦ä¿®æ”¹ï¼Œæ•°æ®è¡¨å
            gc.setAuthor("");
            gc.setOpen(false); //ç”Ÿæˆåæ˜¯å¦æ‰“å¼€èµ„æºç®¡ç†å™¨
            gc.setFileOverride(false); //é‡æ–°ç”Ÿæˆæ—¶æ–‡ä»¶æ˜¯å¦è¦†ç›–
            /*
             * mpç”Ÿæˆserviceå±‚ä»£ç ï¼Œé»˜è®¤æ¥å£åç§°ç¬¬ä¸€ä¸ªå­—æ¯æœ‰ I
             * UcenterService
             * */
            gc.setServiceName("%sService"); //å»æ‰Serviceæ¥å£çš„é¦–å­—æ¯I
            gc.setIdType(IdType.ID_WORKER); //ä¸»é”®ç­–ç•¥
            gc.setDateType(DateType.ONLY_DATE);//å®šä¹‰ç”Ÿæˆçš„å®ä½“ç±»ä¸­æ—¥æœŸç±»å‹
            gc.setSwagger2(true);//å¼€å¯Swagger2æ¨¡å¼
            mpg.setGlobalConfig(gc);
            // 3ã€æ•°æ®æºé…ç½®
            DataSourceConfig dsc = new DataSourceConfig();
            //éœ€è¦ä¿®æ”¹ï¼Œæ•°æ®åº“ url
            dsc.setUrl("jdbc:mysql://localhost:3306/guli?serverTimezone=GMT%2B8");
            dsc.setDriverName("com.mysql.cj.jdbc.Driver");
            //éœ€è¦ä¿®æ”¹ï¼Œæ•°æ®åº“è®¿é—®å
            dsc.setUsername("root");
            //éœ€è¦ä¿®æ”¹ï¼Œæ•°æ®åº“å¯†ç 
            dsc.setPassword("root");
            dsc.setDbType(DbType.MYSQL);
            mpg.setDataSource(dsc);
            // 4ã€åŒ…é…ç½®
            PackageConfig pc = new PackageConfig();
            //éœ€è¦ä¿®æ”¹ï¼Œæ¨¡å—å
            pc.setModuleName("serviceedu"); 
            //éœ€è¦ä¿®æ”¹ï¼Œç»„ç»‡å
            pc.setParent("cn.nilnullnaught");
            pc.setController("controller");
            pc.setEntity("entity");
            pc.setService("service");
            pc.setMapper("mapper");
            mpg.setPackageInfo(pc);
            // 5ã€ç­–ç•¥é…ç½®
            StrategyConfig strategy = new StrategyConfig();
            //éœ€è¦ä¿®æ”¹ï¼Œæ•°æ®è¡¨å
            strategy.setInclude("edu_teacher");
            strategy.setNaming(NamingStrategy.underline_to_camel);//æ•°æ®åº“è¡¨æ˜ å°„åˆ°å®ä½“çš„å‘½åç­–ç•¥
            strategy.setTablePrefix(pc.getModuleName() + "_"); //ç”Ÿæˆå®ä½“æ—¶å»æ‰è¡¨å‰ç¼€
            strategy.setColumnNaming(NamingStrategy.underline_to_camel);//æ•°æ®åº“è¡¨å­—æ®µæ˜ å°„åˆ°å®ä½“çš„å‘½åç­–ç•¥
            strategy.setEntityLombokModel(true); // lombok æ¨¡å‹ @Accessors(chain = true) setteré“¾å¼æ“ä½œ
            strategy.setRestControllerStyle(true); //restful apié£æ ¼æ§åˆ¶å™¨
            strategy.setControllerMappingHyphenStyle(true); //urlä¸­é©¼å³°è½¬è¿å­—ç¬¦
            mpg.setStrategy(strategy);
            // 6ã€æ‰§è¡Œ
            mpg.execute();
        }
    }
}

```

<br>

---

<div STYLE="page-break-after: always;">
    <br>
	<br>
	<br>
	<br>
	<br>
</div>
### 2.2	Mybatisplus ä»£ç ç”Ÿæˆå™¨ï¼ˆ3.5.1ç‰ˆï¼‰

##### æ­¥éª¤

###### ç¬¬ä¸€æ­¥

å¼•å…¥ä¾èµ–ï¼š

```
            <!--mybatis-plus -->
            <dependency>
                <groupId>com.baomidou</groupId>
                <artifactId>mybatis-plus-boot-starter</artifactId>
                <version>${mybatis-plus.version}</version>
            </dependency>
            <!--mybatis-plusä»£ç ç”Ÿæˆå™¨-->
            <dependency>
                <groupId>com.baomidou</groupId>
                <artifactId>mybatis-plus-generator</artifactId>
                <version>${mybatis-plus-generator.version}</version>
            </dependency>
            <!-- freemarker æ¨¡æ¿å¼•æ“ï¼Œmybatis-plus ä»£ç ç”Ÿæˆå™¨ï¼ˆ3.5.1 ç‰ˆæœ¬éœ€è¦ï¼‰-->
            <dependency>
                <groupId>org.freemarker</groupId>
                <artifactId>freemarker</artifactId>
                <version>${freemarker.version}</version>
            </dependency>
```

###### ç¬¬äºŒæ­¥

åœ¨ test ä¸­åˆ›å»ºæ–¹æ³•

```java
    @Test
    public void main1() {
        String url = "";
        String username = "";
        String password = "";
        // è®¾ç½®ä½œè€…
        String author = "";
        // æŒ‡å®šè¾“å‡ºç›®å½•
        String outputDir = System.getProperty("user.dir")+"/src/main/java";
        // è®¾ç½®çˆ¶åŒ…å
        String parent = "";
        //è®¾ç½®çˆ¶åŒ…æ¨¡å—å
        String moduleName = "";
        //è®¾ç½®mapperXmlç”Ÿæˆè·¯å¾„
        String mapperXmlDir = "";
        // è®¾ç½®éœ€è¦ç”Ÿæˆçš„è¡¨å
        String[] tables = {"user_message"};
        // è®¾ç½®è¿‡æ»¤è¡¨å‰ç¼€
        String[] removePrefix = {"t_", "c_"};

        FastAutoGenerator.create(url, username, password)
                .globalConfig(builder -> {
                    builder.author(author) // è®¾ç½®ä½œè€…
                            .enableSwagger() // å¼€å¯ swagger æ¨¡å¼
                            .fileOverride() // è¦†ç›–å·²ç”Ÿæˆæ–‡ä»¶
                            .outputDir(outputDir); // æŒ‡å®šè¾“å‡ºç›®å½•
                })
                .packageConfig(builder -> {
                    builder.parent(parent) // è®¾ç½®çˆ¶åŒ…å
                            .moduleName(moduleName) // è®¾ç½®çˆ¶åŒ…æ¨¡å—å
                            .pathInfo(Collections.singletonMap(OutputFile.mapperXml, mapperXmlDir)); // è®¾ç½®mapperXmlç”Ÿæˆè·¯å¾„
                })
                .strategyConfig(builder -> {
                    builder.addInclude(tables) // è®¾ç½®éœ€è¦ç”Ÿæˆçš„è¡¨å
                            .addTablePrefix(removePrefix) // è®¾ç½®è¿‡æ»¤è¡¨å‰ç¼€
                            .entityBuilder() // Entity ç­–ç•¥é…ç½®
                                .enableLombok() // å¼€å¯ Lombok
                            .controllerBuilder() // Controller ç­–ç•¥é…ç½®
                                .enableRestStyle() // å¼€å¯ç”Ÿæˆ@RestController æ§åˆ¶å™¨
                            .serviceBuilder() // Service ç­–ç•¥é…ç½®
                                .formatServiceFileName("%sService") // å»æ‰å­—æ¯ I
                                .formatServiceImplFileName("%sServiceImpl")
                            .mapperBuilder() // Mapper ç­–ç•¥é…ç½®
                                .enableMapperAnnotation(); // å¼€å¯ @Mapper æ³¨è§£
                })
                .templateEngine(new FreemarkerTemplateEngine()) // ä½¿ç”¨Freemarkerå¼•æ“æ¨¡æ¿(éœ€è¦å¯¼åŒ…)ï¼Œé»˜è®¤çš„æ˜¯Velocityå¼•æ“æ¨¡æ¿
                .execute();
    }
```

<br>

---

<div STYLE="page-break-after: always;">
    <br>
	<br>
	<br>
	<br>
	<br>
</div>

## 3	é…ç½® Swagger

### 3.1	é…ç½® Swagger 2

##### æ³¨æ„

1. Spring Boot åç»­ç‰ˆæœ¬é»˜è®¤é›†æˆäº† Swaggerï¼Œä¸éœ€è¦å¯¼å…¥ Swaggerä¾èµ–ï¼Œä½†æ˜¯å…¶ä»–ç‰ˆæœ¬éœ€è¦ã€‚

2. æ•´åˆæƒé™æ¡†æ¶ï¼ˆæ¯”å¦‚ Spring Securityã€Shiroï¼‰åï¼Œéœ€è¦å¯¹ swagger ç›¸å…³è·¯å¾„æ”¾è¡Œï¼š

   ```java
   // ä»¥ Spring Security ä¸ºä¾‹
   //Swagger 2 éœ€è¦æ’é™¤çš„è·¯å¾„æœ‰ä»¥ä¸‹ï¼š
   registry.addInterceptor(new SaRouteInterceptor())
   .addPathPatterns("/**")
   .excludePathPatterns(
   "/swagger-ui/**",
   "/swagger-resources/**",
   "/webjars/**",
   "/v2/api-docs");
   
   //Swagger 3 éœ€è¦æ’é™¤çš„è·¯å¾„æœ‰ä»¥ä¸‹ï¼š
   registry.addInterceptor(new SaRouteInterceptor())
   .addPathPatterns("/**")
   .excludePathPatterns(
   "/swagger-ui/**",
   "/swagger-resources/**",
   "/webjars/**",
   "/v3/api-docs");
   ```

<br>

##### é…ç½®

###### ç¬¬ä¸€æ­¥

åœ¨ common > service-base ä¸­åˆ›å»º config åŒ…ï¼Œå¹¶åˆ›å»ºswagger çš„é…ç½®ç±»

```java
package cn.nilnullnaught.servicebase.config;

import com.google.common.base.Predicates;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import springfox.documentation.builders.ApiInfoBuilder;
import springfox.documentation.builders.PathSelectors;
import springfox.documentation.service.ApiInfo;
import springfox.documentation.service.Contact;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spring.web.plugins.Docket;
import springfox.documentation.swagger2.annotations.EnableSwagger2;

@Configuration
@EnableSwagger2
public class SwaggerConfig {

    @Bean
    public Docket webApiConfig(){

        return new Docket(DocumentationType.SWAGGER_2)
                .groupName("webApi")
                .apiInfo(webApiInfo())
                .select()
                .paths(Predicates.not(PathSelectors.regex("/admin/.*")))
                .paths(Predicates.not(PathSelectors.regex("/error.*")))
                .build();

    }

    private ApiInfo webApiInfo(){

        return new ApiInfoBuilder()
                .title("ç½‘ç«™-è¯¾ç¨‹ä¸­å¿ƒ API æ–‡æ¡£")
                .description("æœ¬æ–‡æ¡£æè¿°äº†è¯¾ç¨‹ä¸­å¿ƒå¾®æœåŠ¡æ¥å£å®šä¹‰")
                .version("1.0")
                .contact(new Contact("java", "http://atguigu.com", "55317332@qq.com"))
                .build();
    }
}
```

###### ç¬¬äºŒæ­¥

åœ¨ service æ¨¡å—ä¸­å¼•å…¥ service-base

```xml
        <!--å¼•å…¥ service-base æ¨¡å—-->
        <dependency>
            <groupId>cn.nilnullnaught</groupId>
            <artifactId>service-base</artifactId>
            <version>0.0.1-SNAPSHOT</version>
        </dependency>
```

###### ç¬¬ä¸‰æ­¥

åœ¨å¾®æœåŠ¡å­æ¨¡å—ï¼ˆå¦‚ service-edu ï¼‰çš„å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ï¼š

```java
@@SpringBootApplication
@ComponentScan(basePackages = {"cn.nilnullnaught"})
public class EduApplication {

    public static void main(String[] args) {
        SpringApplication.run(EduApplication.class, args);
    }
}
```

###### ç¬¬å››æ­¥

å¼€å¯å¾®æœåŠ¡ï¼Œæ‰“å¼€ `ã€IP åœ°å€ã€‘:ã€æœåŠ¡ç«¯å£ã€‘/swagger-ui.html`ã€‚

<br>

##### å®šä¹‰æ¥å£è¯´æ˜å’Œå‚æ•°è¯´æ˜

- @Apiï¼šå®šä¹‰åœ¨ç±»ä¸Šã€‚
- @ApiOperationï¼šå®šä¹‰åœ¨æ–¹æ³•ä¸Šã€‚
- @ApiParamï¼šå®šä¹‰åœ¨å‚æ•°ä¸Šã€‚

ç¤ºä¾‹ä»£ç ï¼š

```java
Api(description="è®²å¸ˆç®¡ç†")
@RestController
@RequestMapping("/admin/edu/teacher")
public class TeacherAdminController {

	@Autowired
	private TeacherService teacherService;

	@ApiOperation(value = "æ‰€æœ‰è®²å¸ˆåˆ—è¡¨")
	@GetMapping
	public List<Teacher> list(){
		return teacherService.list(null);
	}

	@ApiOperation(value = "æ ¹æ®IDåˆ é™¤è®²å¸ˆ")
	@DeleteMapping("{id}")
	public boolean removeById(
			@ApiParam(name = "id", value = "è®²å¸ˆID", required = true)
			@PathVariable String id){
		return teacherService.removeById(id);
	}
}
```

<br>

---

<div STYLE="page-break-after: always;">
    <br>
	<br>
	<br>
	<br>
	<br>
</div>
### 3.2	âŒï¼ˆå­˜åœ¨é—®é¢˜ï¼‰é…ç½® Swagger3

##### springdocå®˜ç½‘

https://springdoc.org/

<br>

##### swagger2ä¸swagger3æ³¨è§£å¯¹ç…§

æ³¨æ„ï¼šswagger3æ³¨è§£åœ¨ io.swagger.v3.oas.annotations åŒ…ä¸­ï¼Œä¸è¦å¯¼é”™

| swagger2                                    | swagger3                                                     |
| ------------------------------------------- | ------------------------------------------------------------ |
| @Api                                        | @Tag                                                         |
| @ApiIgnore                                  | @Parameter(hidden = true) æˆ– @Operation(hidden = true) æˆ– @Hidden |
| @ApiImplicitParam                           | @Parameter                                                   |
| @ApiImplicitParams                          | @Parameters                                                  |
| @ApiModel                                   | @Schema                                                      |
| @ApiModelProperty(hidden = true)            | @Schema(accessMode = Schema.AccessMode.READ_ONLY)            |
| @ApiModelProperty                           | @Schema                                                      |
| @ApiOperation(value = â€œfooâ€, notes = â€œbarâ€) | @Operation(summary = â€œfooâ€, description = â€œbarâ€)             |
| @ApiParam                                   | @Parameter                                                   |
| @ApiResponse(code = 404, message = â€œfooâ€)   | @ApiResponse(responseCode = â€œ404â€, description = â€œfooâ€)      |

<br>

##### mavenä¾èµ–

```
<dependency>
   <groupId>org.springdoc</groupId>
   <artifactId>springdoc-openapi-ui</artifactId>
   <version>1.5.3</version>
</dependency>
```

<br>

##### swagger3çš„å¼€å¯å’Œå…³é—­

application.ymlï¼š

```
springdoc:
  api-docs:
    enabled: true #é»˜è®¤ä¸ºtrueå¼€å¯
```

<br>

##### swagger3 çš„é…ç½®ç±»

```
import org.springdoc.core.GroupedOpenApi;
import org.springdoc.core.customizers.OperationCustomizer;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.method.HandlerMethod;

import io.swagger.v3.oas.annotations.enums.ParameterIn;
import io.swagger.v3.oas.models.ExternalDocumentation;
import io.swagger.v3.oas.models.OpenAPI;
import io.swagger.v3.oas.models.Operation;
import io.swagger.v3.oas.models.info.Info;
import io.swagger.v3.oas.models.info.License;
import io.swagger.v3.oas.models.media.StringSchema;
import io.swagger.v3.oas.models.parameters.Parameter;

@Configuration
public class Swagger3Config {
	
	//é…ç½®ä¸€ä¸ªtest-publicç»„
	@Bean
	public GroupedOpenApi publicApi() {
		return GroupedOpenApi.builder()
				.group("test-public")
				.packagesToScan("com.szh.demo.material")
//				.pathsToMatch("/material/**")
				.addOperationCustomizer(operationCustomizer())
				.build();
	}
	//é…ç½®å…¶ä»–ç»„
	@Bean
	public GroupedOpenApi otherApi() {
		return GroupedOpenApi.builder()
				.group("test-other")
				.packagesToScan("com.szh.demo.other")
//				.pathsToMatch("/other/**")
				.build();
	}
	
	/**
	 * ç»™æ‰€æœ‰@Operationæ³¨é‡Šçš„æ¥å£æ·»åŠ ä¸€ä¸ªtellernoè¯·æ±‚å¤´å‚æ•°
	 * @return
	 */
	@Bean
	public OperationCustomizer operationCustomizer () {
		return new OperationCustomizer() {
			
			@Override
			public Operation customize(Operation operation, HandlerMethod handlerMethod) {
				operation.addParametersItem(
						new Parameter()
						.in(ParameterIn.HEADER.toString())
						.name("tellerno")
						.description("ç™»å½•ç”¨æˆ·è´¦å·")
						.schema(new StringSchema())
						.required(false)
						);
				return operation;
			}
		};
	}
	
	@Bean
	public OpenAPI openAPI() {
		return new OpenAPI()
	              .info(new Info().title("Swagger3 test API")
	              .description("Swagger3 test sample application")
	              .version("v1.0.0")
	              .license(new License().name("Apache 2.0").url("http://springdoc.org")))
	              .externalDocs(new ExternalDocumentation()
	              .description("SpringShop Wiki Documentation")
	              .url("https://springshop.wiki.github.org/docs"));
    }
    
}
```

<br>

##### Swagger UIé»˜è®¤è®¿é—®åœ°å€

http://server:port/context-path/swagger-ui.html

<br>

---

<div STYLE="page-break-after: always;">
    <br>
	<br>
	<br>
	<br>
	<br>
</div>

## 4	ç»Ÿä¸€è¿”å›æ•°æ®æ ¼å¼

##### ç»Ÿä¸€è¿”å›æ•°æ®æ ¼å¼çš„ä½œç”¨

é¡¹ç›®ä¸­æˆ‘ä»¬ä¼šå°†å“åº”å°è£…æˆ json è¿”å›ï¼Œæ‰€ä»¥ä¸€èˆ¬æˆ‘ä»¬ä¼šå°†æ‰€æœ‰æ¥å£çš„æ•°æ®æ ¼å¼ç»Ÿä¸€ï¼Œ ä½¿å‰ç«¯ï¼ˆiOS Android, Webï¼‰å¯¹æ•°æ®çš„æ“ä½œæ›´ä¸€è‡´ã€è½»æ¾ã€‚

<br>

##### ç»Ÿä¸€è¿”å›æ•°æ®æ ¼å¼çš„éœ€æ±‚

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç»Ÿä¸€è¿”å›æ•°æ®æ ¼å¼æ²¡æœ‰å›ºå®šçš„æ ¼å¼ï¼Œåªè¦èƒ½æè¿°æ¸…æ¥šè¿”å›çš„æ•°æ®çŠ¶æ€ä»¥åŠè¦è¿”å›çš„å…·ä½“æ•°æ®å°±å¯ä»¥ã€‚ä½†æ˜¯ä¸€èˆ¬ä¼šåŒ…å«çŠ¶æ€ç ã€è¿”å›æ¶ˆæ¯ã€æ•°æ®è¿™å‡ éƒ¨åˆ†å†…å®¹

ä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿè¦æ±‚è¿”å›çš„åŸºæœ¬æ•°æ®æ ¼å¼å¦‚ä¸‹ï¼š

**åˆ—è¡¨ï¼š**

```
{
  "success": true,
  "code": 20000,
  "message": "æˆåŠŸ",
  "data": {
    "items": [
      {
        "id": "1",
        "name": "åˆ˜å¾·å",
        "intro": "æ¯•ä¸šäºå¸ˆèŒƒå¤§å­¦æ•°å­¦ç³»ï¼Œçƒ­çˆ±æ•™è‚²äº‹ä¸šï¼Œæ‰§æ•™æ•°å­¦æ€ç»´6å¹´æœ‰ä½™"
      }
    ]
  }
}
```

**åˆ†é¡µï¼š**

```
{
  "success": true,
  "code": 20000,
  "message": "æˆåŠŸ",
  "data": {
    "total": 17,
    "rows": [
      {
        "id": "1",
        "name": "åˆ˜å¾·å",
        "intro": "æ¯•ä¸šäºå¸ˆèŒƒå¤§å­¦æ•°å­¦ç³»ï¼Œçƒ­çˆ±æ•™è‚²äº‹ä¸šï¼Œæ‰§æ•™æ•°å­¦æ€ç»´6å¹´æœ‰ä½™"
      }
    ]
  }
}
```

**æ²¡æœ‰è¿”å›æ•°æ®ï¼š**

```
{
  "success": true,
  "code": 20000,
  "message": "æˆåŠŸ",
  "data": {}
}
```

**å¤±è´¥ï¼š**

```
{
  "success": false,
  "code": 20001,
  "message": "å¤±è´¥",
  "data": {}
}
```

å› æ­¤ï¼Œæˆ‘ä»¬å®šä¹‰ç»Ÿä¸€ç»“æœï¼š

```
{
  "success": å¸ƒå°”, //å“åº”æ˜¯å¦æˆåŠŸ
  "code": æ•°å­—, //å“åº”ç 
  "message": å­—ç¬¦ä¸², //è¿”å›æ¶ˆæ¯
  "data": HashMap //è¿”å›æ•°æ®ï¼Œæ”¾åœ¨é”®å€¼å¯¹ä¸­
}
```

<br>

##### å®ç°ç»Ÿä¸€è¿”å›æ•°æ®æ ¼å¼

###### ç¬¬ä¸€æ­¥

åœ¨ common-utils çš„ cn.nilnullnaught.commonutils åŒ…ä¸‹åˆ›å»ºæ¥å£ï¼Œå®šä¹‰è¿”å›ç ï¼ˆä¹Ÿå¯ä»¥é€šè¿‡æšä¸¾æ–¹å¼å®ç°ï¼‰ï¼š

```java
public interface ResultCode {

    public static Integer SUCCESS = 20000;

    public static Integer ERROR = 20001;
}
```

###### ç¬¬äºŒæ­¥

åœ¨ common-utils çš„ cn.nilnullnaught.commonutils åŒ…ä¸‹åˆ›å»ºç»“æœç±»ï¼š

```java
@Data
public class R {
    @ApiModelProperty(value = "æ˜¯å¦æˆåŠŸ")
    private Boolean success;

    @ApiModelProperty(value = "è¿”å›ç ")
    private Integer code;

    @ApiModelProperty(value = "è¿”å›æ¶ˆæ¯")
    private String message;

    @ApiModelProperty(value = "è¿”å›æ•°æ®")
    private Map<String, Object> data = new HashMap<String, Object>();

    private R(){}

    public static R ok(){
        R r = new R();
        r.setSuccess(true);
        r.setCode(ResultCode.SUCCESS);
        r.setMessage("æˆåŠŸ");
        return r;
    }

    public static R error(){
        R r = new R();
        r.setSuccess(false);
        r.setCode(ResultCode.ERROR);
        r.setMessage("å¤±è´¥");
        return r;
    }

    public R success(Boolean success){
        this.setSuccess(success);
        return this;
    }

    public R message(String message){
        this.setMessage(message);
        return this;
    }

    public R code(Integer code){
        this.setCode(code);
        return this;
    }

    public R data(String key, Object value){
        this.data.put(key, value);
        return this;
    }

    public R data(Map<String, Object> map){
        this.setData(map);
        return this;
    }
```

<br>

##### ä½¿ç”¨ç»Ÿä¸€è¿”å›ç»“æœ

###### ç¬¬ä¸€æ­¥

åœ¨ service æ¨¡å—ä¸­æ·»åŠ  commonutils ä¾èµ–

```xml
        <dependency>
            <groupId>cn.nilnullnaught</groupId>
            <artifactId>common-utils</artifactId>
            <version>0.0.1-SNAPSHOT</version>
        </dependency>
```

###### ç¬¬äºŒæ­¥

ä¿®æ”¹ Controller ä¸­çš„è¿”å›ç»“æœ

```java
@GetMapping
public R list(){
    List<Object> list = objectService.list(null);
    return R.ok().data("items", list);
}
```



---

<div STYLE="page-break-after: always;">
    <br>
	<br>
	<br>
	<br>
	<br>
</div>
## 5	ç»Ÿä¸€å¼‚å¸¸å¤„ç†

##### ä»€ä¹ˆæ˜¯ç»Ÿä¸€å¼‚å¸¸å¤„ç†

è®©å¼‚å¸¸ç»“æœä¹Ÿæ˜¾ç¤ºä¸ºç»Ÿä¸€çš„è¿”å›ç»“æœå¯¹è±¡ï¼Œå¹¶ä¸”ç»Ÿä¸€å¤„ç†ç³»ç»Ÿçš„å¼‚å¸¸ä¿¡æ¯ï¼Œé‚£ä¹ˆéœ€è¦ç»Ÿä¸€å¼‚å¸¸å¤„ç†

<br>

##### @ControllerAdvice 

æ‹¦æˆªæ‰€æœ‰çš„ä»¥ `@Controller` ä¸ºæ³¨è§£çš„ç±»ï¼Œä»¥åŠä»–ä»¬çš„å­ç±»è¿›è¡Œå¼‚å¸¸å¤„ç†ã€‚

<br>

##### @ExceptionHandler(Throwable.class)

è¯¥æ³¨è§£ç”¨äºæŒ‡å®šéœ€è¦å¤„ç†çš„å¼‚å¸¸ç±»å‹ã€‚

<br>

##### åŸºæœ¬å®ç°æ­¥éª¤

###### ç¬¬ä¸€æ­¥

åœ¨ service-base ä¸­åˆ›å»º exceptionhandler åŒ…ï¼Œåœ¨è¯¥åŒ…ä¸‹åˆ›å»ºç»Ÿä¸€å¼‚å¸¸å¤„ç†ç±» GlobalExceptionHandler.javaï¼š

```java
/**
 * ç»Ÿä¸€å¼‚å¸¸å¤„ç†ç±»
 */
@ControllerAdvice
public class GlobalExceptionHandler {

	@ExceptionHandler(Exception.class)
	@ResponseBody
	public R error(Exception e){
		e.printStackTrace();
		return R.error();
	}
}
```

###### ç¬¬äºŒæ­¥

åœ¨controller ä¸­æ·»åŠ æ–¹æ³•ï¼Œäººä¸ºåˆ¶é€ å¼‚å¸¸è¿›è¡Œæµ‹è¯•ï¼š

```java
    @ApiOperation(value = "ç»Ÿä¸€å¼‚å¸¸å¤„ç†æµ‹è¯•")
    @GetMapping("/test")
    public ResponseResult test(){
        int i = 1/0;
        return ResponseResult.ok();
    }
```

<br>

##### å¤„ç†ç‰¹å®šå¼‚å¸¸

###### ç¬¬ä¸€æ­¥

åœ¨ GlobalExceptionHandler.java ä¸­æ·»åŠ å¼‚å¸¸å¤„ç†æ–¹æ³•ï¼š

```java
    @ExceptionHandler(ArithmeticException.class)
    @ResponseBody
    public ResponseResult error(ArithmeticException e){
        e.printStackTrace();
        return ResponseResult.error().message("æ‰§è¡Œäº†è‡ªå®šä¹‰å¼‚å¸¸");
    }
```

###### ç¬¬äºŒæ­¥

è¿›è¡Œæµ‹è¯•ã€‚

<br>

##### è‡ªå®šä¹‰å¼‚å¸¸

###### ç¬¬ä¸€æ­¥

åœ¨ service-base çš„ exceptionhandler è¯¥åŒ…ä¸‹åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼š

```java
@Data
@AllArgsConstructor
@NoArgsConstructor


//è‡ªå®šä¹‰å¼‚å¸¸åº”è¯¥ å¹¶ç»§æ‰¿äºjava.lang.RuntimeExceptionï¼ˆè¡¨ç¤ºå¯å¤„ç†å¯ä¸å¤„ç†ï¼‰
//è¿™æ ·åœ¨æŠ›å‡ºå¼‚å¸¸æ—¶å°±æ— éœ€å¢åŠ é¢å¤– throws æˆ– try{}catch(){} d
public class EduException extends RuntimeException {

    @ApiModelProperty(value = "çŠ¶æ€ç ")
    private Integer code;
    
	@ApiModelProperty(value = "å¼‚å¸¸ä¿¡æ¯")
    private String message;
}
```

###### ç¬¬äºŒæ­¥

åœ¨ä¸šåŠ¡ä¸­éœ€è¦çš„ä½ç½®æŠ›å‡º EduException

```java
try {
    int a = 10/0;
}catch(Exception e) {
    throw new EduException(20001,"å‡ºç°è‡ªå®šä¹‰å¼‚å¸¸");
}
```

###### ç¬¬ä¸‰æ­¥

åœ¨ GlobalExceptionHandler.java ä¸­æ·»åŠ å¼‚å¸¸å¤„ç†æ–¹æ³•ï¼š

```
@ExceptionHandler(GuliException.class)
@ResponseBody
public ResponseResult error(GuliException e){
    e.printStackTrace();
    return ResponseResult.error().message(e.getMsg()).code(e.getCode());
}
```

###### ç¬¬å››æ­¥

æµ‹è¯•ã€‚

<br>

---

<div STYLE="page-break-after: always;">
    <br>
	<br>
	<br>
	<br>
	<br>
</div>

## 6	ç»Ÿä¸€æ—¥å¿—å¤„ç†

##### æ—¥å¿—çº§åˆ«

æ—¥å¿—è®°å½•å™¨ï¼ˆLoggerï¼‰çš„è¡Œä¸ºæ˜¯åˆ†ç­‰çº§çš„ï¼Œåˆ†ä¸ºï¼š

- OFF
- FATAL
- ERROR
- WARN
- INFO
- DEBUG
- ALL

é»˜è®¤æƒ…å†µä¸‹ï¼Œspring boot ä»æ§åˆ¶å°æ‰“å°å‡ºæ¥çš„æ—¥å¿—çº§åˆ«åªæœ‰ INFO åŠä»¥ä¸Šçº§åˆ«ã€‚

<br>

##### åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®æ—¥å¿—çº§åˆ«

```
# è®¾ç½®æ—¥å¿—çº§åˆ«
logging.level.root=WARN
```

æ³¨æ„ï¼Œè¿™ç§æ–¹å¼åªèƒ½å°†æ—¥å¿—æ‰“å°åœ¨æ§åˆ¶å°ä¸Šï¼Œæ— æ³•æŒä¹…åŒ–ã€‚

<br>

##### Logback æ—¥å¿—

spring boot å†…éƒ¨ä½¿ç”¨ Logback ä½œä¸ºæ—¥å¿—å®ç°çš„æ¡†æ¶ã€‚Logback å’Œ log4j éå¸¸ç›¸ä¼¼ï¼Œå¦‚æœä½ å¯¹ log4j å¾ˆç†Ÿæ‚‰ï¼Œé‚£å¯¹ logback å¾ˆå¿«å°±ä¼šå¾—å¿ƒåº”æ‰‹ã€‚

###### logback ç›¸å¯¹äº log4j çš„ä¸€äº›ä¼˜ç‚¹

https://blog.csdn.net/caisini_vc/article/details/48551287

<br>

##### é…ç½® logback æ—¥å¿—

###### ç¬¬ä¸€æ­¥

å¯¼å…¥ä¾èµ–ï¼š

```xml
            <!-- locback -->
            <dependency>
                <groupId>ch.qos.logback</groupId>
                <artifactId>logback-classic</artifactId>
                <version>${logback-classic.version}</version>
            </dependency>
            <!-- slf4j -->
            <dependency>
                <groupId>org.slf4j</groupId>
                <artifactId>slf4j-api</artifactId>
                <version>${slf4j-api.version}</version>
            </dependency>
```

###### ç¬¬äºŒæ­¥

å®‰è£…ideaå½©è‰²æ—¥å¿—æ’ä»¶ï¼šgrep-consoleã€‚

###### ç¬¬ä¸‰æ­¥

åœ¨ resources ä¸­åˆ›å»º logback-spring.xmlï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<configuration  scan="true" scanPeriod="10 seconds">
    <!-- æ—¥å¿—çº§åˆ«ä»ä½åˆ°é«˜åˆ†ä¸ºTRACE < DEBUG < INFO < WARN < ERROR < FATALï¼Œå¦‚æœè®¾ç½®ä¸ºWARNï¼Œåˆ™ä½äºWARNçš„ä¿¡æ¯éƒ½ä¸ä¼šè¾“å‡º -->
    <!-- scan:å½“æ­¤å±æ€§è®¾ç½®ä¸ºtrueæ—¶ï¼Œé…ç½®æ–‡ä»¶å¦‚æœå‘ç”Ÿæ”¹å˜ï¼Œå°†ä¼šè¢«é‡æ–°åŠ è½½ï¼Œé»˜è®¤å€¼ä¸ºtrue -->
    <!-- scanPeriod:è®¾ç½®ç›‘æµ‹é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰ä¿®æ”¹çš„æ—¶é—´é—´éš”ï¼Œå¦‚æœæ²¡æœ‰ç»™å‡ºæ—¶é—´å•ä½ï¼Œé»˜è®¤å•ä½æ˜¯æ¯«ç§’ã€‚å½“scanä¸ºtrueæ—¶ï¼Œæ­¤å±æ€§ç”Ÿæ•ˆã€‚é»˜è®¤çš„æ—¶é—´é—´éš”ä¸º1åˆ†é’Ÿã€‚ -->
    <!-- debug:å½“æ­¤å±æ€§è®¾ç½®ä¸ºtrueæ—¶ï¼Œå°†æ‰“å°å‡ºlogbackå†…éƒ¨æ—¥å¿—ä¿¡æ¯ï¼Œå®æ—¶æŸ¥çœ‹logbackè¿è¡ŒçŠ¶æ€ã€‚é»˜è®¤å€¼ä¸ºfalseã€‚ -->

    <contextName>logback</contextName>
    <!-- nameçš„å€¼æ˜¯å˜é‡çš„åç§°ï¼Œvalueçš„å€¼æ˜¯å˜é‡å®šä¹‰çš„å€¼ã€‚é€šè¿‡å®šä¹‰çš„å€¼ä¼šè¢«æ’å…¥åˆ°loggerä¸Šä¸‹æ–‡ä¸­ã€‚å®šä¹‰å˜é‡åï¼Œå¯ä»¥ä½¿â€œ${}â€æ¥ä½¿ç”¨å˜é‡ã€‚ -->
    <property name="log.path" value="D://log" />

    <!-- å½©è‰²æ—¥å¿— -->
    <!-- é…ç½®æ ¼å¼å˜é‡ï¼šCONSOLE_LOG_PATTERN å½©è‰²æ—¥å¿—æ ¼å¼ -->
    <!-- magenta:æ´‹çº¢ -->
    <!-- boldMagenta:ç²—çº¢-->
    <!-- cyan:é’è‰² -->
    <!-- white:ç™½è‰² -->
    <!-- magenta:æ´‹çº¢ -->
    <property name="CONSOLE_LOG_PATTERN"
              value="%yellow(%date{yyyy-MM-dd HH:mm:ss}) |%highlight(%-5level) |%blue(%thread) |%blue(%file:%line) |%green(%logger) |%cyan(%msg%n)"/>


    <!--è¾“å‡ºåˆ°æ§åˆ¶å°-->
    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <!--æ­¤æ—¥å¿—appenderæ˜¯ä¸ºå¼€å‘ä½¿ç”¨ï¼Œåªé…ç½®æœ€åº•çº§åˆ«ï¼Œæ§åˆ¶å°è¾“å‡ºçš„æ—¥å¿—çº§åˆ«æ˜¯å¤§äºæˆ–ç­‰äºæ­¤çº§åˆ«çš„æ—¥å¿—ä¿¡æ¯-->
        <!-- ä¾‹å¦‚ï¼šå¦‚æœæ­¤å¤„é…ç½®äº†INFOçº§åˆ«ï¼Œåˆ™åé¢å…¶ä»–ä½ç½®å³ä½¿é…ç½®äº† DEBUG çº§åˆ«çš„æ—¥å¿—ï¼Œä¹Ÿä¸ä¼šè¢«è¾“å‡º -->
        <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
            <!--<level>INFO</level>-->
            <level>DEBUG</level>
        </filter>
        <encoder>
            <Pattern>${CONSOLE_LOG_PATTERN}</Pattern>
            <!-- è®¾ç½®å­—ç¬¦é›† -->
            <charset>UTF-8</charset>
        </encoder>
    </appender>


    <!--è¾“å‡ºåˆ°æ–‡ä»¶-->

    <!-- æ—¶é—´æ»šåŠ¨è¾“å‡º levelä¸º INFO æ—¥å¿— -->
    <appender name="INFO_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <!-- æ­£åœ¨è®°å½•çš„æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„åŠæ–‡ä»¶å -->
        <file>${log.path}/log_info.log</file>
        <!--æ—¥å¿—æ–‡ä»¶è¾“å‡ºæ ¼å¼-->
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n</pattern>
            <charset>UTF-8</charset>
        </encoder>
        <!-- æ—¥å¿—è®°å½•å™¨çš„æ»šåŠ¨ç­–ç•¥ï¼ŒæŒ‰æ—¥æœŸï¼ŒæŒ‰å¤§å°è®°å½• -->
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <!-- æ¯å¤©æ—¥å¿—å½’æ¡£è·¯å¾„ä»¥åŠæ ¼å¼ -->
            <fileNamePattern>${log.path}/info/log-info-%d{yyyy-MM-dd}.%i.log</fileNamePattern>
            <timeBasedFileNamingAndTriggeringPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP">
                <maxFileSize>100MB</maxFileSize>
            </timeBasedFileNamingAndTriggeringPolicy>
            <!--æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤©æ•°-->
            <maxHistory>15</maxHistory>
        </rollingPolicy>
        <!-- æ­¤æ—¥å¿—æ–‡ä»¶åªè®°å½•infoçº§åˆ«çš„ -->
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <level>INFO</level>
            <onMatch>ACCEPT</onMatch>
            <onMismatch>DENY</onMismatch>
        </filter>
    </appender>

    <!-- æ—¶é—´æ»šåŠ¨è¾“å‡º levelä¸º WARN æ—¥å¿— -->
    <appender name="WARN_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <!-- æ­£åœ¨è®°å½•çš„æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„åŠæ–‡ä»¶å -->
        <file>${log.path}/log_warn.log</file>
        <!--æ—¥å¿—æ–‡ä»¶è¾“å‡ºæ ¼å¼-->
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n</pattern>
            <charset>UTF-8</charset> <!-- æ­¤å¤„è®¾ç½®å­—ç¬¦é›† -->
        </encoder>
        <!-- æ—¥å¿—è®°å½•å™¨çš„æ»šåŠ¨ç­–ç•¥ï¼ŒæŒ‰æ—¥æœŸï¼ŒæŒ‰å¤§å°è®°å½• -->
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>${log.path}/warn/log-warn-%d{yyyy-MM-dd}.%i.log</fileNamePattern>
            <timeBasedFileNamingAndTriggeringPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP">
                <maxFileSize>100MB</maxFileSize>
            </timeBasedFileNamingAndTriggeringPolicy>
            <!--æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤©æ•°-->
            <maxHistory>15</maxHistory>
        </rollingPolicy>
        <!-- æ­¤æ—¥å¿—æ–‡ä»¶åªè®°å½•warnçº§åˆ«çš„ -->
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <level>warn</level>
            <onMatch>ACCEPT</onMatch>
            <onMismatch>DENY</onMismatch>
        </filter>
    </appender>


    <!-- æ—¶é—´æ»šåŠ¨è¾“å‡º levelä¸º ERROR æ—¥å¿— -->
    <appender name="ERROR_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <!-- æ­£åœ¨è®°å½•çš„æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„åŠæ–‡ä»¶å -->
        <file>${log.path}/log_error.log</file>
        <!--æ—¥å¿—æ–‡ä»¶è¾“å‡ºæ ¼å¼-->
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n</pattern>
            <charset>UTF-8</charset> <!-- æ­¤å¤„è®¾ç½®å­—ç¬¦é›† -->
        </encoder>
        <!-- æ—¥å¿—è®°å½•å™¨çš„æ»šåŠ¨ç­–ç•¥ï¼ŒæŒ‰æ—¥æœŸï¼ŒæŒ‰å¤§å°è®°å½• -->
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>${log.path}/error/log-error-%d{yyyy-MM-dd}.%i.log</fileNamePattern>
            <timeBasedFileNamingAndTriggeringPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP">
                <maxFileSize>100MB</maxFileSize>
            </timeBasedFileNamingAndTriggeringPolicy>
            <!--æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤©æ•°-->
            <maxHistory>15</maxHistory>
        </rollingPolicy>
        <!-- æ­¤æ—¥å¿—æ–‡ä»¶åªè®°å½•ERRORçº§åˆ«çš„ -->
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <level>ERROR</level>
            <onMatch>ACCEPT</onMatch>
            <onMismatch>DENY</onMismatch>
        </filter>
    </appender>

    <!--
        <logger>ç”¨æ¥è®¾ç½®æŸä¸€ä¸ªåŒ…æˆ–è€…å…·ä½“çš„æŸä¸€ä¸ªç±»çš„æ—¥å¿—æ‰“å°çº§åˆ«ã€ä»¥åŠæŒ‡å®š<appender>ã€‚
        <logger>ä»…æœ‰ä¸€ä¸ªnameå±æ€§ï¼Œ
        ä¸€ä¸ªå¯é€‰çš„levelå’Œä¸€ä¸ªå¯é€‰çš„addtivityå±æ€§ã€‚
        name:ç”¨æ¥æŒ‡å®šå—æ­¤loggerçº¦æŸçš„æŸä¸€ä¸ªåŒ…æˆ–è€…å…·ä½“çš„æŸä¸€ä¸ªç±»ã€‚
        level:ç”¨æ¥è®¾ç½®æ‰“å°çº§åˆ«ï¼Œå¤§å°å†™æ— å…³ï¼šTRACE, DEBUG, INFO, WARN, ERROR, ALL å’Œ OFFï¼Œ
              å¦‚æœæœªè®¾ç½®æ­¤å±æ€§ï¼Œé‚£ä¹ˆå½“å‰loggerå°†ä¼šç»§æ‰¿ä¸Šçº§çš„çº§åˆ«ã€‚
    -->
    <!--
        ä½¿ç”¨mybatisçš„æ—¶å€™ï¼Œsqlè¯­å¥æ˜¯debugä¸‹æ‰ä¼šæ‰“å°ï¼Œè€Œè¿™é‡Œæˆ‘ä»¬åªé…ç½®äº†infoï¼Œæ‰€ä»¥æƒ³è¦æŸ¥çœ‹sqlè¯­å¥çš„è¯ï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§æ“ä½œï¼š
        ç¬¬ä¸€ç§æŠŠ<root level="INFO">æ”¹æˆ<root level="DEBUG">è¿™æ ·å°±ä¼šæ‰“å°sqlï¼Œä¸è¿‡è¿™æ ·æ—¥å¿—é‚£è¾¹ä¼šå‡ºç°å¾ˆå¤šå…¶ä»–æ¶ˆæ¯
        ç¬¬äºŒç§å°±æ˜¯å•ç‹¬ç»™mapperä¸‹ç›®å½•é…ç½®DEBUGæ¨¡å¼ï¼Œä»£ç å¦‚ä¸‹ï¼Œè¿™æ ·é…ç½®sqlè¯­å¥ä¼šæ‰“å°ï¼Œå…¶ä»–è¿˜æ˜¯æ­£å¸¸DEBUGçº§åˆ«ï¼š
     -->
    <!--å¼€å‘ç¯å¢ƒ:æ‰“å°æ§åˆ¶å°-->
    <springProfile name="dev">
        <!--å¯ä»¥è¾“å‡ºé¡¹ç›®ä¸­çš„debugæ—¥å¿—ï¼ŒåŒ…æ‹¬mybatisçš„sqlæ—¥å¿—-->
        <logger name="cn.nilnullnaught.nnnnote" level="DEBUG" />

        <!--
            rootèŠ‚ç‚¹æ˜¯å¿…é€‰èŠ‚ç‚¹ï¼Œç”¨æ¥æŒ‡å®šæœ€åŸºç¡€çš„æ—¥å¿—è¾“å‡ºçº§åˆ«ï¼Œåªæœ‰ä¸€ä¸ªlevelå±æ€§
            level:ç”¨æ¥è®¾ç½®æ‰“å°çº§åˆ«ï¼Œå¤§å°å†™æ— å…³ï¼šTRACE, DEBUG, INFO, WARN, ERROR, ALL å’Œ OFFï¼Œé»˜è®¤æ˜¯DEBUG
            å¯ä»¥åŒ…å«é›¶ä¸ªæˆ–å¤šä¸ªappenderå…ƒç´ ã€‚
        -->
        <root level="INFO">
            <appender-ref ref="CONSOLE" />
            <appender-ref ref="INFO_FILE" />
            <appender-ref ref="WARN_FILE" />
            <appender-ref ref="ERROR_FILE" />
        </root>
    </springProfile>


    <!--ç”Ÿäº§ç¯å¢ƒ:è¾“å‡ºåˆ°æ–‡ä»¶-->
    <springProfile name="pro">

        <root level="INFO">
            <appender-ref ref="CONSOLE" />
            <appender-ref ref="DEBUG_FILE" />
            <appender-ref ref="INFO_FILE" />
            <appender-ref ref="ERROR_FILE" />
            <appender-ref ref="WARN_FILE" />
        </root>
    </springProfile>

</configuration>
```

###### ç¬¬å››æ­¥

å°†é”™è¯¯æ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œåœ¨ GlobalExceptionHandler.java ä¸­æ·»åŠ æ³¨è§£ `@Slf4j`ï¼ˆå¦‚æœä¸æƒ³æ¯æ¬¡éƒ½å†™ `private final Logger logger = LoggerFactory.getLogger(å½“å‰ç±»å.class);` å¯ä»¥ç”¨`@Slf4`jï¼‰ï¼Œä¸å¼‚å¸¸è¾“å‡ºè¯­å¥ `log.error(e.getMessage());`ï¼š

```java
@ControllerAdvice
@Slf4j
public class GlobalExceptionHandler {

    @ExceptionHandler(Exception.class)
    @ResponseBody
    public R error(Exception e){
        log.error(e.getMessage());
        e.printStackTrace();
        return R.error();
    }
}
```

<br>

##### å°†æ—¥å¿—å †æ ˆä¿¡æ¯è¾“å‡ºåˆ°æ–‡ä»¶

###### ç¬¬ä¸€æ­¥

åœ¨ common-utils ä¸‹åˆ›å»º util åŒ…ï¼Œåˆ›å»º ExceptionUtil.java å·¥å…·ç±»ï¼š

```
package com.guli.common.util;

public class ExceptionUtil {

	public static String getMessage(Exception e) {
		StringWriter sw = null;
		PrintWriter pw = null;
		try {
			sw = new StringWriter();
			pw = new PrintWriter(sw);
			// å°†å‡ºé”™çš„æ ˆä¿¡æ¯è¾“å‡ºåˆ°printWriterä¸­
			e.printStackTrace(pw);
			pw.flush();
			sw.flush();
		} finally {
			if (sw != null) {
				try {
					sw.close();
				} catch (IOException e1) {
					e1.printStackTrace();
				}
			}
			if (pw != null) {
				pw.close();
			}
		}
		return sw.toString();
	}
}
```

###### ç¬¬äºŒæ­¥

åœ¨è‡ªå®šä¹‰å¼‚å¸¸ç±»ä¸­åˆ›å»º toString() æ–¹æ³•

```
@Data
@AllArgsConstructor
@NoArgsConstructor
public class MyException {

    @ApiModelProperty(value = "çŠ¶æ€ç ")
    private Integer code;

    @ApiModelProperty(value = "å¼‚å¸¸æç¤ºä¿¡æ¯")
    private String message;

    @Override
    public String toString() {
        return "EduException{" +
                "message=" + this.getMessage() +
                ", code=" + code +
                '}';
    }
}
```

###### ç¬¬ä¸‰æ­¥

åœ¨ GlobalExceptionHandler.java ä¸­çš„å¼‚å¸¸å¤„ç†æ–¹æ³•ä¸­è°ƒç”¨ï¼š

```java
@ControllerAdvice
@Slf4j
public class GlobalExceptionHandler {

    @ExceptionHandler(Exception.class)
    @ResponseBody
    public R error(Exception e){
        log.error(ExceptionUtil.getMessage(e));
        log.error(e.getMessage());
        e.printStackTrace();
        return R.error();
    }
}
```

<br>

---

<div STYLE="page-break-after: always;">
    <br>
	<br>
	<br>
	<br>
	<br>
</div>

## 8	å¸¸ç”¨åŠŸèƒ½å®ç°

### 8.1	é€»è¾‘åˆ é™¤

##### å®ç°æ­¥éª¤

###### ç¬¬ä¸€æ­¥

åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯é€»è¾‘åˆ é™¤ï¼ˆå·²å®Œæˆï¼‰ã€‚

###### ç¬¬äºŒæ­¥

åœ¨ MyBatisPlusConfig ä¸­é…ç½®é€»è¾‘åˆ é™¤æ’ä»¶ï¼š

```java
/** é€»è¾‘åˆ é™¤æ’ä»¶ */
@Bean
public ISqlInjector sqlInjector() {
    return new LogicSqlInjector();
}
```

###### ç¬¬ä¸‰æ­¥

åœ¨ Controller ä¸­ æ·»åŠ åˆ é™¤æ–¹æ³•ï¼š

```java
@DeleteMapping("{id}")
public boolean removeById(@PathVariable String id){
    return teacherService.removeById(id);
}
```

<br>

---

<div STYLE="page-break-after: always;">
    <br>
	<br>
	<br>
	<br>
	<br>
</div>

### 8.2	è‡ªåŠ¨å¡«å……æ•°æ®

##### æ­¥éª¤

###### ç¬¬ä¸€æ­¥

åœ¨éœ€è¦è¿›è¡Œè‡ªåŠ¨å¡«å……çš„å­—æ®µå¯¹åº”çš„å®ä½“ç±»å±æ€§ä¸Šæ·»åŠ  `@TableField` æ³¨è§£

```java
@ApiModelProperty(value = "åˆ›å»ºæ—¶é—´")
@TableField(fill = FieldFill.INSERT)
private Date gmtCreate;

@ApiModelProperty(value = "æ›´æ–°æ—¶é—´")
@TableField(fill = FieldFill.INSERT_UPDATE)
private Date gmtModified;
```

###### ç¬¬äºŒæ­¥

åœ¨ common > service-base æ¨¡å—ä¸‹åˆ›å»º handler åŒ…ã€‚

###### ç¬¬ä¸‰æ­¥

åœ¨ handler åŒ…ä¸‹å®ç°å…ƒå¯¹è±¡å¤„ç†å™¨æ¥å£ MyMetaObjectHandler.java

```
package cn.nilnullnaught.servicebase.handler;

import com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;
import org.apache.ibatis.reflection.MetaObject;
import org.springframework.stereotype.Component;

import java.util.Date;

@Component
public class MyMetaObjectHandler implements MetaObjectHandler {
    @Override
    public void insertFill(MetaObject metaObject) {
        //å±æ€§åç§°ï¼Œä¸æ˜¯å­—æ®µåç§°
        this.setFieldValByName("gmtCreate", new Date(), metaObject);
        this.setFieldValByName("gmtModified", new Date(), metaObject);
    }

    @Override
    public void updateFill(MetaObject metaObject) {
        this.setFieldValByName("gmtModified", new Date(), metaObject);
    }
}
```

<br>

---

<div STYLE="page-break-after: always;">
    <br>
	<br>
	<br>
	<br>
	<br>
</div>

### 8.3	è·¨åŸŸé…ç½®

##### å®ç°è·¨åŸŸ

åœ¨ Controller ä¸Šæ·»åŠ æ³¨è§£ `@CrossOrigin`ã€‚

<br>

---

<div STYLE="page-break-after: always;">
    <br>
	<br>
	<br>
	<br>
	<br>
</div>
### 8.4	åˆ†é¡µå’Œæ¡ä»¶æŸ¥è¯¢

##### åˆ†é¡µå®ç°æ­¥éª¤

###### ç¬¬ä¸€æ­¥

åœ¨ MyBatisPlusConfig ä¸­é…ç½®åˆ†é¡µæ’ä»¶

```
/**
 * åˆ†é¡µæ’ä»¶
 */
@Bean
public PaginationInterceptor paginationInterceptor() {
    return new PaginationInterceptor();
}
```

###### ç¬¬äºŒæ­¥

åœ¨ Controller ä¸­æ·»åŠ åˆ†é¡µæ–¹æ³•

```java
    @ApiOperation(value = "åˆ†é¡µè®²å¸ˆåˆ—è¡¨")
    @GetMapping("{page}/{limit}")
    public ResponseResult pageList(
            @ApiParam(name = "page", value = "å½“å‰é¡µç ", required = true)
            @PathVariable Long page,
            @ApiParam(name = "limit", value = "æ¯é¡µè®°å½•æ•°", required = true)
            @PathVariable Long limit){

        Page<EduTeacher> pageParam = new Page<>(page, limit);

        eduTeacherService.page(pageParam, null);
        List<EduTeacher> records = pageParam.getRecords();
        long total = pageParam.getTotal();

        return  ResponseResult.ok().data("total", total).data("rows", records);
    }
```

###### ç¬¬ä¸‰æ­¥

æµ‹è¯•ã€‚

<br>

##### æ·»åŠ æŸ¥è¯¢å®ç°æ­¥éª¤

###### ç¬¬ä¸€æ­¥

åˆ›å»ºåŒ… cn.nilnullnaught.serviceedu.entity.voï¼Œåœ¨åŒ…ä¸­åˆ›å»º EduTeacherQuery.java æŸ¥è¯¢å¯¹è±¡ã€‚

```
package cn.nilnullnaught.serviceedu.entity.vo;

import io.swagger.annotations.ApiModel;
import io.swagger.annotations.ApiModelProperty;

@ApiModel(value = "TeacheræŸ¥è¯¢å¯¹è±¡", description = "è®²å¸ˆæŸ¥è¯¢å¯¹è±¡å°è£…")
public class EduTeacherQuery {
    private static final long serialVersionUID = 1L;

    @ApiModelProperty(value = "æ•™å¸ˆåç§°,æ¨¡ç³ŠæŸ¥è¯¢")
    private String name;

    @ApiModelProperty(value = "å¤´è¡” 1é«˜çº§è®²å¸ˆ 2é¦–å¸­è®²å¸ˆ")
    private Integer level;

    @ApiModelProperty(value = "æŸ¥è¯¢å¼€å§‹æ—¶é—´", example = "2019-01-01 10:10:10")
    private String begin;//æ³¨æ„ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯Stringç±»å‹ï¼Œå‰ç«¯ä¼ è¿‡æ¥çš„æ•°æ®æ— éœ€è¿›è¡Œç±»å‹è½¬æ¢

    @ApiModelProperty(value = "æŸ¥è¯¢ç»“æŸæ—¶é—´", example = "2019-12-01 10:10:10")
    private String end;

	//çœç•¥ getter ä¸ setter 
}

```

###### ç¬¬äºŒæ­¥

åœ¨ service åŒ…çš„ EduTeacherService æ¥å£ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

```java
public interface EduTeacherService extends IService<EduTeacher> {
    void pageQuery(Page<EduTeacher> pageParam, EduTeacherQuery teacherQuery);
}
```

###### ç¬¬ä¸‰æ­¥

åœ¨ service > impl åŒ…çš„ EduTeacherServiceImpl ç±»ä¸­è¿›è¡Œå®ç°

```java
package cn.nilnullnaught.serviceedu.service.impl;

/**
 * <p>
 * è®²å¸ˆ æœåŠ¡å®ç°ç±»
 * </p>
 *
 * @author nilnullnaught
 * @since 2021-10-15
 */
@Service
public class EduTeacherServiceImpl extends ServiceImpl<EduTeacherMapper, EduTeacher> implements EduTeacherService {

    @Override
    public void pageQuery(Page<EduTeacher> pageParam, EduTeacherQuery teacherQuery) {

        QueryWrapper<EduTeacher> queryWrapper = new QueryWrapper<>();
        queryWrapper.orderByAsc("sort");

        if (teacherQuery == null){
            baseMapper.selectPage(pageParam, queryWrapper);
            return;
        }

        String name = teacherQuery.getName();
        Integer level = teacherQuery.getLevel();
        String begin = teacherQuery.getBegin();
        String end = teacherQuery.getEnd();

		//å¯¼å…¥ org.springframework.util.StringUtils åŒ…
        if (!StringUtils.isEmpty(name)) {
            queryWrapper.like("name", name);
        }

        if (!StringUtils.isEmpty(level) ) {
            queryWrapper.eq("level", level);
        }

        if (!StringUtils.isEmpty(begin)) {
            queryWrapper.ge("gmt_create", begin);
        }

        if (!StringUtils.isEmpty(end)) {
            queryWrapper.le("gmt_create", end);
        }

        baseMapper.selectPage(pageParam, queryWrapper);
    }
}

```

###### ç¬¬å››æ­¥

ä¿®æ”¹controller çš„ pageList æ–¹æ³•ï¼Œä¸ºåˆ†é¡µæŸ¥è¯¢æ·»åŠ æ¡ä»¶æŸ¥è¯¢ï¼š

```
@ApiOperation(value = "åˆ†é¡µè®²å¸ˆåˆ—è¡¨")
    @GetMapping("{page}/{limit}")
    public ResponseResult pageList(

            @ApiParam(name = "page", value = "å½“å‰é¡µç ", required = true)
            @PathVariable Long page,

            @ApiParam(name = "limit", value = "æ¯é¡µè®°å½•æ•°", required = true)
            @PathVariable Long limit,

            @ApiParam(name = "eduTeacherQuery", value = "æŸ¥è¯¢å¯¹è±¡", required = false)
                    EduTeacherQuery eduTeacherQuery) {


        //åˆ›å»ºåˆ†é¡µå¯¹è±¡
        Page<EduTeacher> pageParam = new Page<>(page, limit);

        //ä½¿ç”¨ service ä¸­çš„æ¡ä»¶æŸ¥è¯¢ API
        eduTeacherService.pageQuery(pageParam,eduTeacherQuery);

        List<EduTeacher> records = pageParam.getRecords();
        long total = pageParam.getTotal();

        return ResponseResult.ok().data("total", total).data("rows", records);
    }
```

<br>

---

<div STYLE="page-break-after: always;">
    <br>
	<br>
	<br>
	<br>
	<br>
</div>

### 8.5	æ–°å¢ã€ä¿®æ”¹ã€ç®€å•æŸ¥è¯¢

##### æ–°å¢

```java
    @ApiOperation(value = "æ–°å¢è®²å¸ˆ")
    @PostMapping
    public ResponseResult save(
            @ApiParam(name = "teacher", value = "è®²å¸ˆå¯¹è±¡", required = true)
            @RequestBody EduTeacher eduTeacher){

        eduTeacherService.save(eduTeacher);
        return ResponseResult.ok();
    }
```

<br>

##### æ ¹æ®idæŸ¥è¯¢

```java
    @ApiOperation(value = "æ ¹æ®IDæŸ¥è¯¢è®²å¸ˆ")
    @GetMapping("{id}")
    public ResponseResult getById(
            @ApiParam(name = "id", value = "è®²å¸ˆID", required = true)
            @PathVariable String id){

        EduTeacher eduTeacher = eduTeacherService.getById(id);
        return ResponseResult.ok().data("item", eduTeacher);
    }
```

<br>

##### æ ¹æ®idä¿®æ”¹

```java
    @ApiOperation(value = "æ ¹æ®IDä¿®æ”¹è®²å¸ˆ")
    @PutMapping("{id}")
    public ResponseResult updateById(
            @ApiParam(name = "id", value = "è®²å¸ˆID", required = true)
            @PathVariable String id,

            @ApiParam(name = "teacher", value = "è®²å¸ˆå¯¹è±¡", required = true)
            @RequestBody EduTeacher eduTeacher){

        eduTeacher.setId(id);
        eduTeacherService.updateById(eduTeacher);
        return ResponseResult.ok();
    }
```

<br>

----

<div STYLE="page-break-after: always;">
    <br>
	<br>
	<br>
	<br>
	<br>
</div>
