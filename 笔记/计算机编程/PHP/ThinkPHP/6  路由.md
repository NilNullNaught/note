# è·¯ç”±

## 6.1	è·¯ç”±åŸºæœ¬ä½¿ç”¨

##### è·¯ç”±çš„ä½œç”¨

â€‹	è·¯ç”±çš„ä½œç”¨å°±æ˜¯ **è®© `URL` åœ°å€æ›´åŠ çš„è§„èŒƒå’Œä¼˜é›…ï¼Œæˆ–è€…è¯´æ›´åŠ ç®€æ´**ï¼Œè®¾ç½®è·¯ç”±å¯¹ URL çš„æ£€æµ‹ã€éªŒè¯ç­‰ä¸€ç³»åˆ—æ“ä½œæä¾›äº†æå¤§çš„ä¾¿åˆ©æ€§ã€‚

<br/>

##### å¼€å¯è·¯ç”±

â€‹	è·¯ç”±æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œå¦‚æœæƒ³è¦å…³é—­è·¯ç”±ï¼Œéœ€è¦åœ¨ `config/app.php` ä¸­è¿›è¡Œé…ç½®ï¼š

```php
// æ˜¯å¦å¯ç”¨è·¯ç”±
'with_route' => false
```

<br/>

##### è·¯ç”±çš„é…ç½®æ–‡ä»¶ä¸å®šä¹‰æ–‡ä»¶

###### é…ç½®æ–‡ä»¶

â€‹	è·¯ç”±çš„é…ç½®æ–‡ä»¶åœ¨ `config/route.php` ä¸­ã€‚

###### å®šä¹‰æ–‡ä»¶

â€‹	å®šä¹‰æ–‡ä»¶ç”¨äºå®šä¹‰è·¯ç”±è§„åˆ™ï¼Œä½äºåœ¨ `route/app.php`ä¸­ã€‚`route` ç›®å½•ä¸‹çš„æ–‡ä»¶çš„æ–‡ä»¶ååªè¦ç¬¦åˆå‘½åè§„åˆ™å³å¯ï¼Œä¸”å¯ä»¥æœ‰å¤šä¸ªå®šä¹‰æ–‡ä»¶ï¼Œ

<br/>

##### ä¾‹â€”â€”è·¯ç”±åŸºæœ¬ä½¿ç”¨

1. åˆ›å»ºä¸€ä¸ª Address æ§åˆ¶å™¨ç±»ï¼Œåˆ›å»ºä¸¤ä¸ªæ–¹æ³•

   ```php
   class Address{
   	public function index(){
   		return 'index';
   	}
   	
   	public function details($id){
   		return 'details ç›®å‰è°ƒç”¨çš„ idï¼š'.$id;
   	}
   }
   ```

2. åœ¨æ²¡æœ‰å®šä¹‰è·¯ç”±è§„åˆ™çš„æƒ…å†µä¸‹ï¼Œè®¿é—® address/details ï¼š

   ```
   åœ°å€ï¼šhttp://localhost:8000/address/details/id/5
   ç»“æœï¼šdetails ç›®å‰è°ƒç”¨çš„ idï¼š5
   ```

3. åœ¨ `route` ä¸‹çš„ `app.php` é‡Œé…ç½®è·¯ç”±è§„åˆ™ï¼š

   ```php
   Route::rule('details/:id', 'Address/details');
   ```

4. ä½¿ç”¨è·¯ç”±è§„åˆ™çš„ URL è¿›è¡Œè®¿é—®ï¼š

   ```php
   åœ°å€ï¼šhttp://localhost:8000/details/5
   ç»“æœï¼šdetails ç›®å‰è°ƒç”¨çš„ idï¼š5
   ```

<br/>

##### é™åˆ¶è¯·æ±‚çš„ç±»å‹

â€‹	rule() é»˜è®¤ä»»ä½•è¯·æ±‚ç±»å‹å‡å¯è®¿é—®ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ `rule()` çš„ç¬¬ä¸‰ä¸ªå‚æ•°è¿›è¡Œé™åˆ¶ï¼š

```php
Route::rule('details/:id', 'Address/xxx, 'GET'); //GET
Route::rule('details/:id', 'Address/xxx, 'POST'); //POST
Route::rule('details/:id', 'Address/xxx, 'GET|POST'); //GET æˆ– POST
```

rule() ç¬¬ä¸‰ä¸ªå‚æ•°å¯ä»¥ä½¿ç”¨çš„å€¼ï¼š

- GET(get)
- POST(post)
- DELETE(delete)
- PUT(put)
- PATCH(patch)
- *(anyï¼Œä»»æ„è¯·æ±‚æ–¹å¼)

<br/>

##### è·¯ç”±é…ç½®æ–¹æ³•çš„å¿«æ·æ–¹å¼

â€‹	ç›´æ¥ç”¨ `Route::get(...)`ã€`Route::post(...)`ã€`Route::delete(...)` ç­‰æ–¹æ³•å³å¯ï¼Œæ— é¡»ç¬¬ä¸‰å‚æ•°ï¼›

<br/>

##### å¼ºåˆ¶è·¯ç”±

â€‹	å¼€å¯å¼ºåˆ¶è·¯ç”±éœ€è¦åœ¨ `route.php` ä¸­è¿›è¡Œé…ç½®ï¼Œå¼€å¯å¼ºåˆ¶è·¯ç”±åå¿…é¡»è®¾ç½®é¦–é¡µè·¯ç”±[^6.1-1]ï¼›

```php
//åœ¨ route.php ä¸­è¿›è¡Œé…ç½®
'url_route_must' => true,
```

```php
//åœ¨ route/app.php ä¸­è¿›è¡Œé…ç½®
Route::rule('/', 'Index/index'); //åæ–œæ å°±æ˜¯é¦–é¡µé»˜è®¤è®¿é—®çš„åœ°å€
```

<br/>

##### è·¯ç”±è§„åˆ™è¡¨è¾¾å¼çš„é…ç½®è§„åˆ™

â€‹	åœ¨è·¯ç”±çš„è§„åˆ™è¡¨è¾¾å¼ä¸­ï¼Œæœ‰å¤šç§åœ°å€çš„é…ç½®è§„åˆ™ï¼Œå…·ä½“å¦‚ä¸‹ï¼š

```php
//é™æ€è·¯ç”±
Route::rule('ad', 'Address/index');
//é™æ€åŠ¨æ€ç»“åˆçš„åœ°å€
Route::rule('details/:id', 'Address/details');
//å¤šå‚æ•°é™æ€åŠ¨æ€ç»“åˆçš„åœ°å€
Route::rule('search/:id/:uid', 'Address/search');
//å…¨åŠ¨æ€åœ°å€ï¼Œä¸é™åˆ¶æ˜¯å¦ search å›ºå®š
Route::rule(':search/:id/:uid', 'Address/search');
//åŒ…å«å¯é€‰å‚æ•°çš„åœ°å€
Route::rule('find/:id/[:content]', 'Address/find');
//è§„åˆ™å®Œå…¨åŒ¹é…çš„åœ°å€
Route::rule('search/:id/:uid$', 'Address/search');
```

<br/>

##### åœ¨æ§åˆ¶å™¨ä¸­ç”Ÿæˆè·¯ç”±åœ°å€å¯¹åº”çš„å®é™…åœ°å€

â€‹	è·¯ç”±å®šä¹‰å¥½ä¹‹åï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦è·å¾—è¯¥åœ°å€çš„å®é™…åœ°å€ï¼Œå¯ä»¥é€šè¿‡ `url()` æ–¹æ³•å®ç°ï¼›

```php
//ä¸å®šä¹‰æ ‡è¯†çš„åšæ³•
return url('Address/details', ['id'=>10]);
//å®šä¹‰æ ‡è¯†çš„åšæ³•
Route::rule('details/:id', 'Address/details')->name('det');
return url('det', ['id'=>10])
```

<br/>

---

[^6.1-1]: å¼€å¯å¼ºåˆ¶è·¯ç”±åï¼Œè®¿é—®é¦–é¡µå°±ä¼šæŠ¥é”™ï¼Œå¿…é¡»å¼ºåˆ¶è®¾ç½®é¦–é¡µè·¯ç”±

<div STYLE="page-break-after: always;">
    <br>
    <br>
    <br>
    <br>
    <br></div>
## 6.2	è·¯ç”±çš„å˜é‡è§„åˆ™ä¸é—­åŒ…

##### å˜é‡è§„åˆ™

â€‹	ç³»ç»Ÿé»˜è®¤çš„è·¯ç”±å˜é‡è§„åˆ™ä¸º `\w+`ï¼Œå³å­—æ¯ã€æ•°å­—ã€ä¸­æ–‡å’Œä¸‹åˆ’çº¿ï¼Œå¦‚æœä½ æƒ³æ›´æ”¹é»˜è®¤çš„åŒ¹é…è§„åˆ™ï¼Œå¯ä»¥ä¿®æ”¹ `config/route.php` é…ç½®ï¼š

```php
// é»˜è®¤çš„è·¯ç”±å˜é‡è§„åˆ™
'default_route_pattern' => '[\w\.]+',
```

<br/>

##### å¯¹å…·ä½“çš„å˜é‡è¿›è¡Œå•ç‹¬çš„è§„åˆ™è®¾ç½®

###### é€šè¿‡ pattern() è®¾ç½®

â€‹	å¦‚æœæˆ‘ä»¬éœ€è¦å¯¹å…·ä½“çš„å˜é‡è¿›è¡Œå•ç‹¬çš„è§„åˆ™è®¾ç½®ï¼Œåˆ™éœ€è¦é€šè¿‡ `pattern()`:

```php
Route::rule('details/:id', 'Address/details')
->pattern(['id'=>'\d+']);//å‘ details æ–¹æ³•é‡Œçš„ id ä¼ å€¼ï¼Œä¸¥æ ¼é™åˆ¶å¿…é¡»åªèƒ½æ˜¯æ•°å­—(\d+)ï¼›
```

###### å¯¹å¤šä¸ªå˜é‡è¿›è¡Œè®¾ç½®

â€‹	ä¹Ÿå¯ä»¥è®¾ç½®ä¸¤ä¸ªæˆ–ä»¥ä¸Šå€¼çš„è§„åˆ™ï¼Œé€šè¿‡æ•°ç»„çš„æ–¹å¼ä¼ é€’å‚:

```php
Route::rule('search/:id/:uid', 'Address/search')
	->pattern([
		'id' => '\d+',
		'uid' => '\d+'
]);
```

###### è®¾ç½®å…¨å±€å˜é‡è§„åˆ™

â€‹	ä»¥ä¸Šä¸¤ç§ï¼Œå‡ä¸ºå±€éƒ¨å˜é‡è§„åˆ™ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨ app.php è®¾ç½®å…¨å±€å˜é‡è§„åˆ™ï¼š

```php
Route::pattern([
	'id' => '\d+',
	'uid' => '\d+'
]);
```

###### ä½¿ç”¨ç»„åˆå˜é‡è®¾ç½®è·¯ç”±è§„åˆ™

```php
Route::rule('details-<id>', 'address/details')
  ->pattern('id', '\d+');
```

###### åŠ¨æ€ç»„åˆæ‹¼è£…

â€‹	åŠ¨æ€ç»„åˆçš„æ‹¼è£…ï¼Œåœ°å€å’Œå‚æ•°å¦‚æœéƒ½æ˜¯æ¨¡ç³ŠåŠ¨æ€çš„ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•ï¼›

```php
Route::rule('details-:name-:id', 'Hello:name/index')
  ->pattern('id', '\d+');
```

<br/>

##### é—­åŒ…æ”¯æŒ

â€‹	é—­åŒ…æ”¯æŒæˆ‘ä»¬å¯ä»¥é€šè¿‡ URL ç›´æ¥æ‰§è¡Œï¼Œè€Œä¸éœ€è¦é€šè¿‡æ§åˆ¶å™¨å’Œæ–¹æ³•ï¼š

```php
Route::get('think', function () {
  return 'hello,ThinkPHP5!';
  });
```

â€‹	é—­åŒ…æ”¯æŒä¹Ÿå¯ä»¥ä¼ é€’å‚æ•°å’ŒåŠ¨æ€è§„åˆ™ï¼š

```
Route::get('hello/:name', function ($name) {
  return 'Hello,' . $name;
  })
```

<br/>

---

<div STYLE="page-break-after: always;">
    <br>
    <br>
    <br>
    <br>
    <br></div>

## 6.3	è·¯ç”±çš„åœ°å€

##### è·¯ç”±åœ°å€çš„ç»“æ„

â€‹	è·¯ç”±çš„åœ°å€ä¸€èˆ¬ä¸ºï¼š`æ§åˆ¶å™¨/æ“ä½œæ–¹æ³•`ï¼›

```php
//é»˜è®¤ Index æ§åˆ¶å™¨
Route::rule('/', 'index');

//æ§åˆ¶å™¨/æ“ä½œæ–¹æ³•
Route::rule('details/:id', 'Address/details');
```

<br/>

##### å¤šçº§ç›®å½•ä¸‹çš„æ§åˆ¶å™¨çš„è·¯ç”±åœ°å€

â€‹	è·¯ç”±æ”¯æŒå¤šçº§ç›®å½•åŠæ§åˆ¶å™¨ï¼Œå¹¶ä¸”æ”¯æŒè·¯ç”±åˆ°ç›¸åº”çš„åœ°å€ï¼š

```php
//ç›®å½•ä¸ºï¼šapp\controller\group
namespace app\controller\group;

//åœ°å€ä¸ºï¼šapp\controller\group
http://localhost:8000/group.blog/details/id/5

//æ”¯æŒå¤šçº§è·¯ç”±
Route::rule('details/:id', 'group.Blog/details');
```

<br/>

##### é€šè¿‡å®Œæ•´è·¯å¾„æ‰§è¡Œæ“ä½œæ–¹æ³•

###### ä½¿ç”¨ @ 

â€‹	å¯ä»¥é€šè¿‡ `å®Œæ•´ç±»å@æ“ä½œæ–¹æ³•` æ ¼å¼å»è®¿é—®æ“ä½œæ–¹æ³•ï¼š

```
Route::rule('ds/:id', '\app\controller\Address@details');
```

###### è®¿é—®é™æ€æ“ä½œæ–¹æ³•

â€‹	å®Œæ•´è·¯å¾„æ”¯æŒé€šè¿‡ `å®Œæ•´ç±»å::é™æ€æ–¹æ³•` æ ¼å¼çš„è·¯ç”±åœ°å€è®¿é—®é™æ€æ“ä½œæ–¹æ³•ï¼š

```php
//è°ƒç”¨
Route::rule('ds/:id', '\app\controller\Address::details');
```

<br/>

##### è·¯ç”±é‡å®šå‘

â€‹	è·¯ç”±å¯ä»¥é€šè¿‡ `::redirect()` æ–¹æ³•å®ç°é‡å®šå‘è·³è½¬ï¼Œè¯¥æ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºçŠ¶æ€ç ï¼š

```php
Route::redirect('ds/:id', 'http://localhost/', 302);
```

<br/>

---

<div STYLE="page-break-after: always;">
    <br>
    <br>
    <br>
    <br>
    <br></div>

## 6.4	è·¯ç”±çš„å‚æ•°

##### ä»€ä¹ˆæ˜¯è·¯ç”±çš„å‚æ•°

â€‹	è®¾ç½®è·¯ç”±çš„æ—¶å€™ï¼Œå¯ä»¥è®¾ç½®ç›¸å…³æ–¹æ³•è¿›è¡ŒåŒ¹é…æ£€æµ‹å’Œè¡Œä¸ºæ‰§è¡Œï¼Œå³è·¯ç”±çš„å‚æ•°ã€‚

<br/>

##### æ£€æµ‹ URL åç¼€

â€‹	`ext()` æ–¹æ³•çš„ä½œç”¨æ˜¯æ£€æµ‹ `URL` åç¼€ï¼Œæ¯”å¦‚ï¼šæˆ‘ä»¬å¼ºåˆ¶æ‰€æœ‰ `URL` åç¼€ä¸º `.html`ï¼š

```php
Route::rule('details/:id', 'address/details')->ext('html');
Route::rule('details/:id', 'address/details')->ext('html|shtml');
```

<br/>

##### æ£€æµ‹æ˜¯å¦ä¸º https è¯·æ±‚

`https` æ–¹æ³•ä½œç”¨æ˜¯æ£€æµ‹æ˜¯å¦ä¸º `https` è¯·æ±‚ï¼Œç»“åˆ `ext` å¼ºåˆ¶ `html` å¦‚ä¸‹ï¼š

```php
Route::get('details/:id', 'address/details')->ext('html')->https();
```

<br/>

##### å…¨å±€ç»Ÿä¸€é…ç½® URL åç¼€

â€‹	å¦‚æœæƒ³è®©å…¨å±€ç»Ÿä¸€é…ç½® URL åç¼€çš„è¯ï¼Œå¯ä»¥åœ¨ `config/route.php` ä¸­è®¾ç½®ï¼Œå…·ä½“å€¼å¯ä»¥æ˜¯å•ä¸ªæˆ–å¤šä¸ªåç¼€ï¼Œä¹Ÿå¯ä»¥æ˜¯ç©ºå­—ç¬¦ä¸²ï¼ˆå³ä»»æ„åç¼€ï¼‰ï¼Œæˆ– `false` ï¼ˆç¦æ­¢åç¼€ï¼‰ï¼›

```php
//è®¾ç½® false ä¸ºç¦æ­¢åç¼€ï¼Œç©ºå…è®¸æ‰€æœ‰åç¼€
'url_html_suffix' => 'html', 
```

<br/>

##### ç¦æ­¢é»˜å†™åç¼€çš„ä½¿ç”¨

â€‹	`denyExt()` çš„ä½œç”¨æ˜¯ç¦æ­¢æŸäº›åç¼€çš„ä½¿ç”¨ï¼Œä½¿ç”¨åç›´æ¥æŠ¥é”™

```php
Route::rule('details/:id', 'address/details')->denyExt('gif|jpg|png');
```

<br/>

##### æ£€æµ‹å½“å‰çš„åŸŸåæ˜¯å¦åŒ¹é…

â€‹	`domain()` çš„ä½œç”¨æ˜¯æ£€æµ‹å½“å‰çš„åŸŸåæ˜¯å¦åŒ¹é…ï¼Œå®Œæ•´åŸŸåå’Œå­åŸŸåå‡å¯æ£€æµ‹ï¼›

```
Route::rule('ds/:id', 'Address/details')->domain('localhost');
Route::rule('ds/:id', 'Address/details')->domain('news.abc.com');
Route::rule('ds/:id', 'Address/details')->domain('news');
```

<br/>

##### æ£€æµ‹å½“å‰çš„é¡µé¢æ˜¯å¦æ˜¯æŒ‡å®šçš„è¯·æ±‚æ–¹å¼

â€‹	ajax()ã€pjax()ã€json() çš„ä½œç”¨æ˜¯æ£€æµ‹å½“å‰çš„é¡µé¢æ˜¯å¦æ˜¯ä»¥ä¸Šè¯·æ±‚æ–¹å¼ï¼›

```php
Route::rule('ds/:id', 'Address/details')->ajax();
```

<br/>

##### å¯¹é¢å¤–å‚æ•°è¿›è¡Œæ£€æµ‹

â€‹	`filter()` ä½œç”¨æ˜¯å¯¹é¢å¤–å‚æ•°è¿›è¡Œæ£€æµ‹ï¼Œé¢å¤–å‚æ•°å¯è¡¨å•æäº¤ï¼š

```php
Route::rule('details/:id', 'address/details')->filter(['id'=>5, 'type'=>1]);
```

<br/>

##### è¿½åŠ é¢å¤–å‚æ•°

â€‹	`append()` ä½œç”¨æ˜¯è¿½åŠ é¢å¤–å‚æ•°ï¼Œè¿™ä¸ªé¢å¤–å‚æ•°å¹¶ä¸éœ€è¦é€šè¿‡ `URL` ä¼ é€’ï¼š

```php
Route::rule('details/:id', 'address/details')->append(['status'=>1]);
```

<br/>

##### ç»Ÿä¸€é…ç½®å¤šä¸ªå‚æ•°

â€‹	å¦‚æœä½ æƒ³ç»Ÿä¸€é…ç½®å¤šä¸ªå‚æ•°ï¼Œæ–¹ä¾¿ç®¡ç†ï¼Œå¯ä»¥ä½¿ç”¨ `option()` é…ç½®ï¼›

```php
Route::rule('ds/:id', 'Address/details')->option([
'ext' => 'html',
'https' => true
])
```

<br/>

---

<div STYLE="page-break-after: always;">
    <br>
    <br>
    <br>
    <br>
    <br></div>

## 6.5	è·¯ç”±çš„åŸŸåå’Œè·¨åŸŸè¯·æ±‚

##### ä½¿ç”¨åŸŸåè·¯ç”±

1. è¦ä½¿ç”¨åŸŸåè·¯ç”±ï¼Œé¦–å…ˆï¼Œåœ¨æœ¬åœ°æˆ‘ä»¬éœ€è¦é€šè¿‡ `hosts` æ–‡ä»¶æ¥æ˜ å°„ï¼Œæ‰“å¼€ `C:\Windows\System32\drivers\etc` æ‰¾åˆ° `hosts` æ–‡ä»¶ï¼Œåœ¨æœ«å°¾æ·»åŠ ä¸€å¥ï¼š`127.0.0.1 news.abc.com` æ˜ å°„äºŒçº§åŸŸåã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬è®¿é—® `news.abc.com` å°±ç›´æ¥æ˜ å°„åˆ° `localhost` é‡Œäº†ã€‚

2. å¦‚æœæƒ³è®¿é—® thinkphp ç‹¬ç«‹çš„æœåŠ¡å™¨ï¼Œå¼€å¯åï¼Œç›´æ¥ `:8080` å³å¯ï¼›

   ```http
   http://news.abc.com:8000
   ```

<br/>

##### é™å®šåŸŸåçš„æœ‰æ•ˆèŒƒå›´

â€‹	å¦‚æœæƒ³é™å®šåœ¨ `news.abc.com` è¿™ä¸ªåŸŸåä¸‹æ‰æœ‰æ•ˆï¼Œå¯ä»¥é€šè¿‡åŸŸåè·¯ç”±é—­åŒ…çš„è®¾ç½®ï¼š

```php
Route::domain('news', function () {
	Route::rule('details/:id', 'Address/details');
});
```

<br/>

##### è®¾ç½®å®Œæ•´åŸŸå

â€‹	é™¤äº†äºŒçº§åŸŸåï¼ˆå­åŸŸåï¼‰çš„å¼€å¤´éƒ¨åˆ†ï¼Œä¹Ÿå¯ä»¥è®¾ç½®å®Œæ•´åŸŸåï¼š

```php
Route::domain('news.abc.com', function () {
	Route::rule('details/:id', 'Address/details');
});
```

<br/>

##### è®¾ç½®å¤šä¸ªäºŒçº§åŸŸå

â€‹	æ”¯æŒå¤šä¸ªäºŒçº§åŸŸåå¼€å¤´éƒ¨åˆ†ï¼Œä½¿ç”¨ç›¸åŒçš„è·¯æœ‰è§„åˆ™ï¼›

```php
Route::domain(['news', 'blog', 'live'], function () {
	Route::rule('details/:id', 'Address/details');
});
```

<br/>

##### å¯¹åŸŸåè¿›è¡Œæ ¡éªŒ

â€‹	å¯ä»¥ `domain()` å¯¹äºŒçº§åŸŸåæˆ–å®Œæ•´åŸŸåè¿›è¡Œæ ¡éªŒ

```
Route::rule('details/:id', 'Address/details')->domain('news');
Route::rule('details/:id', 'Address/details')->domain('news.abc.com');
```

<br/>

##### å…¶ä»–åŸŸåæ“ä½œ

â€‹	è·¯ç”±åŸŸåä¹Ÿæ”¯æŒï¼šextã€patternã€append ç­‰è·¯ç”±å‚æ•°æ–¹æ³•çš„æ“ä½œã€‚

<br/>

##### è·¨åŸŸè¯·æ±‚

â€‹	å½“ä¸åŒåŸŸåè¿›è¡Œè·¨åŸŸè¯·æ±‚çš„æ—¶å€™ï¼Œç”±äºæµè§ˆå™¨çš„å®‰å…¨é™åˆ¶ä¼šè¢«æ‹¦æˆªï¼Œä¸ºäº†è§£é™¤è¿™ä¸ªé™åˆ¶ï¼Œæˆ‘ä»¬é€šè¿‡è·¯ç”± `allowCrossDomain()` æ¥å®ç°ï¼š

```php
Route::rule('details/:id', 'Address/details')->allowCrossDomain();
```

â€‹	å®ç°äº†è·¨åŸŸçš„ç½‘é¡µä¸æ²¡æœ‰å®ç°çš„ç›¸æ¯”ï¼Œ header å¤´æ–‡ä»¶å¤šäº†å‡ æ¡å¼€å¤´ä¸º Access çš„ä¿¡æ¯ï¼Œæ­¤æ—¶ï¼Œè¿™ä¸ªé¡µé¢ï¼Œå°±å¯ä»¥æ”¯æŒè·¨åŸŸè¯·æ±‚çš„æ“çºµäº†ã€‚

<br/>

##### ä¾‹â€”â€”è·¨åŸŸè¯·æ±‚éªŒè¯

1. æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä¸åŒç«¯å£å·æˆ–ä¸åŒåŸŸåçš„ ajax æŒ‰é’®ï¼Œç‚¹å‡»è·å–è¿™ä¸ªè·¯ç”±é¡µé¢ä¿¡æ¯ï¼š

   ```html
   <!DOCTYPE html>
   <html lang="zh-cn">
   <head>
   	<meta charset="UTF-8">
   	<title>æ¨¡æ‹Ÿæäº¤</title>
   </head>
   <body>
   
   <input type="button" id="button" value="ç¡®å®š">
   <div id="show"></div>
   
   <!-- å¼•å…¥jQueryæ–‡ä»¶ -->
   <script src="js/jquery-3.4.1.js"></script>
   <script>
   $("#button").click(function(){
       let id = 5;
   	$.ajax({
       	type : "DELETE",
   		data : {
   			'id' : id,
   			'type' : 1
   		},
   		//url : "http://localhost:8000/blog/10",
   		url : "http://localhost/tp6/public/rely/get",
   		success : function (res) {
   			//console.log(res);
   			$('#show').html(res);
   		}
       });
   });
   </script>
   </body>
   </html>
   ```

2. å¦‚æœï¼Œæ²¡æœ‰å¼€å¯è·¨åŸŸè¯·æ±‚ï¼Œåˆ™ä¼šçˆ†å‡ºæé†’ï¼š

   ```
   å·²æ‹¦æˆªè·¨æºè¯·æ±‚ï¼šåŒæºç­–ç•¥ç¦æ­¢è¯»å–ä½äº http://localhost:8000/details/5.html çš„è¿œç¨‹èµ„æºã€‚ï¼ˆåŸå› ï¼šCORS å¤´
   ç¼ºå°‘ 'Access-Control-Allow-Origin'ï¼‰
   ```

3. å¼€å¯åï¼Œå³æ­£å¸¸è·å–å¾—åˆ°çš„æ•°æ®ã€‚

<br/>

##### é™åˆ¶è·¨åŸŸè¯·æ±‚çš„åŸŸå

```php
Route::rule col/:id', 'Collect/read')
	->allowCrossDomain([
		'Access-Control-Allow-Origin' => 'http://news.abc.com:8000'
	])
```

<br/>

---

<div STYLE="page-break-after: always;">
    <br>
    <br>
    <br>
    <br>
    <br></div>

## 6.6	è·¯ç”±çš„åˆ†ç»„å’Œ MISS

##### ä»€ä¹ˆæ˜¯è·¯ç”±åˆ†ç»„

â€‹	è·¯ç”±åˆ†ç»„ï¼Œå³ **å°†ç›¸åŒå‰ç¼€çš„è·¯ç”±åˆå¹¶åˆ†ç»„**ï¼Œè¿™æ ·å¯ä»¥ç®€åŒ–è·¯ç”±å®šä¹‰ï¼Œæé«˜åŒ¹é…æ•ˆç‡ã€‚

<br/>

##### åˆ†ç»„è·¯ç”±çš„æ³¨å†Œ

â€‹	ä½¿ç”¨ `group()` ï¼Œæ¥è¿›è¡Œåˆ†ç»„è·¯ç”±çš„æ³¨å†Œï¼š

```php
Route::group('address', function () {
	Route::rule(':id', 'Address/details');
	Route::rule(':name', 'Address/search');
})->ext('html')->pattern(['id'=>'\d+', 'name'=>'\w+']);
```

â€‹	ä¹Ÿå¯ä»¥çœå»ç¬¬ä¸€å‚æ•°ï¼Œè®©åˆ†ç»„è·¯ç”±æ›´çµæ´»ä¸€äº›ï¼›

```php
Route::group(function () {
	Route::rule('ds/:id', 'Address/details');
	Route::rule('sr/:name', 'Address/search');
})->ext('html')->pattern(['id'=>'\d+', 'name'=>'\w+']);
```

<br/>

##### çœç•¥åˆ†ç»„åœ°å€é‡Œçš„æ§åˆ¶å™¨

â€‹	ä½¿ç”¨ `prefix()`ï¼Œå¯ä»¥çœç•¥æ‰åˆ†ç»„åœ°å€é‡Œçš„æ§åˆ¶å™¨ï¼š

```php
Route::group('address', function () {
	Route::rule(':id', 'details');
	Route::rule(':name', 'search');
})->ext('html')->prefix('Address/')->pattern(['id'=>'\d+', 'name'=>'\w+']);
```

<br/>

##### ä¼ å…¥é¢å¤–å‚æ•°

â€‹	ä½¿ç”¨ `append()`ï¼Œå¯ä»¥é¢å¤–ä¼ å…¥å‚æ•°ï¼š

```php
Route::group()...
    ->append(['status'=>1]);
```

<br/>

##### å»¶è¿Ÿè§£æğŸ“Œ

â€‹	è·¯ç”±è§„åˆ™[^6.6-1]å®šä¹‰çš„æ–‡ä»¶ï¼ŒåŠ è½½æ—¶ä¼šè§£ææ¶ˆè€—è¾ƒå¤šçš„èµ„æºï¼Œå°¤å…¶æ˜¯è§„åˆ™ç‰¹åˆ«åºå¤§çš„æ—¶å€™ï¼Œå¼€å¯å»¶è¿Ÿè§£æå¯ä»¥åªåœ¨åŒ¹é…çš„æ—¶å€™æ‰ä¼šæ³¨å†Œè§£æã€‚

â€‹	åœ¨ `route.php` ä¸­å¼€å¯å»¶è¿Ÿè§£æï¼š

```php
//å¤šå¤åˆ¶å‡ ç»„è§„åˆ™ï¼Œç„¶åæ¥æŸ¥çœ‹å†…å­˜å ç”¨
'url_lazy_route' => true, 
```

<br/>

---

[^6.6-1]: ä¸»è¦æ˜¯åˆ†ç»„å’ŒåŸŸåè·¯ç”±ã€‚

<div STYLE="page-break-after: always;">
    <br>
    <br>
    <br>
    <br>
    <br></div>

## 6.7	MISS è·¯ç”±

##### å…¨å±€ MISS

â€‹	ç±»ä¼¼å¼€å¯å¼ºåˆ¶è·¯ç”±åŠŸèƒ½ï¼ŒåŒ¹é…ä¸åˆ°ç›¸åº”è§„åˆ™æ—¶è‡ªåŠ¨è·³è½¬åˆ° `MISS`

```php
Route::miss('public/miss');
```

##### åˆ†ç»„ MISS

â€‹	å¯ä»¥åœ¨åˆ†ç»„ä¸­ä½¿ç”¨ miss()ï¼Œå½“ä¸æ»¡è¶³åŒ¹é…è§„åˆ™æ—¶è·³è½¬åˆ°è¿™é‡Œï¼›

```php
Route::miss('miss')
```

<br/>

---

<div STYLE="page-break-after: always;">
    <br>
    <br>
    <br>
    <br>
    <br></div>

## 6.8	èµ„æºè·¯ç”±

##### ä»€ä¹ˆæ˜¯èµ„æºè·¯ç”±

â€‹	èµ„æºè·¯ç”±ï¼Œé‡‡ç”¨å›ºå®šçš„å¸¸ç”¨æ–¹æ³•æ¥å®ç°ç®€åŒ– `URL` çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š

```php
Route::resource('ads', 'Address');
```

<br/>

##### å¿«é€Ÿç”Ÿæˆèµ„æºæ§åˆ¶å™¨

â€‹	ç³»ç»Ÿæä¾›äº†ä¸‹åˆ—å‘½ä»¤ï¼Œç”¨äºæ–¹ä¾¿å¼€å‘è€…å¿«é€Ÿç”Ÿæˆä¸€ä¸ªèµ„æºæ§åˆ¶å™¨ï¼š

```shell
php think make:controller Blog
```

â€‹	ç”Ÿæˆçš„æ–¹æ³•ï¼ŒåŒ…å«äº†æ˜¾ç¤ºã€å¢åˆ æ”¹æŸ¥ç­‰å¤šä¸ªæ“ä½œæ–¹æ³•ã€‚

<br/>

##### åˆ›å»ºèµ„æºè·¯ç”±

åœ¨è·¯ç”±å®šä¹‰æ–‡ä»¶ä¸‹åˆ›å»ºä¸€ä¸ªèµ„æºè·¯ç”±ï¼Œèµ„æºåç§°å¯è‡ªå®šä¹‰ï¼›

```php
Route::resource('blog', 'Blog');
```

- è¿™é‡Œçš„ `blog` è¡¨ç¤ºèµ„æºè§„åˆ™åï¼Œ`Blog` è¡¨ç¤ºè·¯ç”±çš„è®¿é—®è·¯å¾„ï¼›

<br/>

##### èµ„æºè·¯ç”±æ³¨å†ŒæˆåŠŸåï¼Œè‡ªåŠ¨æä¾›çš„æ–¹æ³•

â€‹	èµ„æºè·¯ç”±æ³¨å†ŒæˆåŠŸåï¼Œä¼šè‡ªåŠ¨æä¾›ä»¥ä¸‹æ–¹æ³•ï¼Œæ— é¡»æ‰‹åŠ¨æ³¨å†Œï¼ˆä»¥ä¹‹å‰åˆ›å»ºçš„ blog èµ„æºè·¯ç”±ä¸ºä¾‹ï¼‰ï¼š

- GET è¯·æ±‚ï¼šindex(blog)ã€create(blog/create)ã€read(blog/:id)ã€edit(blog/:id/edit)ï¼›
- POST è¯·æ±‚ï¼šsave(blog)ï¼›
- PUT è¯·æ±‚ï¼šupdate(blog/:id)ï¼›
- DELETE è¯·æ±‚ï¼šdelete(blog/:id)ï¼›

```http
http://localhost:8000/blog/ (index)
http://localhost:8000/blog/5 (read)
http://localhost:8000/blog/5/edit (edit)
```

<br/>

##### ä¾‹â€”â€”è®¿é—®èµ„æºè·¯ç”±

```javascript
$.ajax({
	type : "DELETE",
	url : "http://localhost:8000/blog/10",
	success : function (res) {
		console.log(res);
	}
});
```

<br/>

##### èµ„æºè·¯ç”±çš„é»˜è®¤å‚æ•°

â€‹	é»˜è®¤çš„å‚æ•°é‡‡ç”¨ id å­—æ®µï¼Œå¦‚æœéœ€è¦ä½¿ç”¨å…¶ä»–å­—æ®µï¼Œæ¯”å¦‚ blog_idï¼Œåˆ™ï¼š

```php
->vars(['blog'=>'blog_id']); //ç›¸åº”çš„ delete($blog_id)
```

<br/>

##### é™å®šç³»ç»Ÿæä¾›çš„èµ„æºæ–¹æ³•

â€‹	å¯ä»¥é€šè¿‡ `only()` é™å®šç³»ç»Ÿæä¾›çš„èµ„æºæ–¹æ³•ï¼Œæ¯”å¦‚ï¼š

```php
->only(['index','save','create'])
```

<br/>

##### æ’é™¤ç³»ç»Ÿæä¾›çš„èµ„æºæ–¹æ³•

â€‹	å¯ä»¥é€šè¿‡ `except()` æ–¹æ³•æ’é™¤ç³»ç»Ÿæä¾›çš„èµ„æºæ–¹æ³•ï¼Œæ¯”å¦‚ï¼š

```php
->except(['read','delete','update'])
```

<br/>

##### ä¿®æ”¹ç³»ç»Ÿæä¾›é»˜è®¤æ–¹æ³•

â€‹	ä½¿ç”¨ `rest()` ä¿®æ”¹ç³»ç»Ÿç»™äºˆçš„é»˜è®¤æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„å‚æ•°ä¸ºï¼š

1. è¯·æ±‚æ–¹å¼
2. åœ°å€
3. æ“ä½œ

```php
Route::rest('create', ['GET', '/:id/add', 'add']);

//æ‰¹é‡
Route::rest([
	'save' => ['POST', '', 'store'],
	'update' => ['PUT', '/:id', 'save'],
	'delete' => ['DELETE', '/:id', 'destory'],
]);
```

<br/>

##### åµŒå¥—èµ„æºè·¯ç”±

â€‹	ä½¿ç”¨åµŒå¥—èµ„æºè·¯ç”±ï¼Œå¯ä»¥è®©ä¸Šçº§èµ„æºå¯¹ä¸‹çº§èµ„æºè¿›è¡Œæ“ä½œã€‚

###### ä¾‹â€”â€”åˆ›å»º Comment èµ„æº

```php
class Comment{
	public function read($id, $blog_id){
		return 'Comment id:'.$id.'ï¼ŒBlog id:'.$blog_id;
	}
    
	public function edit($id, $blog_id){
		return 'Comment id:'.$id.'ï¼ŒBlog id:'.$blog_id;
	}
}
```

```php
Route::resource('blog.comment', 'Comment');
```

###### èµ„æºåµŒå¥—ç”Ÿæˆçš„è·¯ç”±è§„åˆ™

```http
http://localhost:8000/blog/:blog_id/comment/:id
http://localhost:8000/blog/:blog_id/comment/:id/edit
```

##### åµŒå¥—èµ„æºé»˜è®¤çš„ä¸Šçº§èµ„æºè®¿é—®å‚æ•°

â€‹	åµŒå¥—èµ„æºç”Ÿæˆçš„ä¸Šçº§èµ„æºé»˜è®¤è®¿é—® `id` ä¸º `blog_id`ï¼Œå¯ä»¥é€šè¿‡ `vars` æ›´æ”¹ï¼›

```php
Route::resource('blog.comment', 'Comment')
->vars(['blog'=>'blogid'])
```

<br/>

---

<div STYLE="page-break-after: always;">
    <br>
    <br>
    <br>
    <br>
    <br></div>

## 6.9	æ³¨è§£è·¯ç”±

##### åœ¨ ThinkPHP ä¸­ä½¿ç”¨æ³¨è§£è·¯ç”±

â€‹	ThinkPHP é»˜è®¤ä¸æ”¯æŒæ³¨è§£è·¯ç”±ï¼Œéœ€è¦å®‰è£…é¢å¤–çš„æ‰©å±•æ‰å¯ä»¥ä½¿ç”¨ã€‚

<br/>

##### æ­¥éª¤â€”â€”ä½¿ç”¨æ³¨è§£è·¯ç”±

1. å®‰è£…æ³¨è§£è·¯ç”±æ‰©å±•ï¼š

   ```shell
   #æ‰§è¡Œä»¥ä¸‹å®‰è£…å‘½ä»¤å³å¯å®Œæˆå®‰è£…
   composer require topthink/think-annotation
   ```

2. åœ¨éœ€è¦ä½¿ç”¨æ³¨è§£è·¯ç”±çš„æ–‡ä»¶ä¸­ï¼Œå¼•å…¥ç›¸å…³ç±»åº“ï¼š

   ```php
   use think\annotation\Route;
   ```

3. åœ¨æ§åˆ¶å™¨è®¾ç½®æ³¨è§£ä»£ç å³å¯ï¼Œå¯ä»¥ä½¿ç”¨ PHPDOC ç”Ÿæˆä¸€æ®µï¼Œç„¶åæ·»åŠ è·¯ç”±è§„åˆ™ï¼š

   ```php
   æ³¨æ„ï¼šè¿™é‡Œå¿…é¡»ä½¿ç”¨åŒå¼•å·ï¼Œå•å¼•å·ä¼šç›´æ¥æŠ¥é”™ï¼›
   @param $id
   @return string
   @route("details/:id");
   ```

   ç¬¬äºŒæˆ–ä»¥ä¸Šå‚æ•°ï¼Œå¯ä»¥è®¾ç½®è¯·æ±‚ç±»å‹ï¼Œæ¯”å¦‚è¦æ±‚æ˜¯ GET æ¨¡å¼è®¿é—®ï¼š

   ```php
   @route("ds/:id", method="GET")
   ```

   æ›´å¤šå‚æ•°å¯å®ç°æ›´å¤šåŠŸèƒ½(ä¸éœ€è¦è€ƒè™‘é¡ºåº)ï¼Œæ¯”å¦‚ extã€https ç­‰ï¼š

   ```php
   @route("ds/:id", method="GET", ext="html", https=1) //å¸ƒå°”å€¼ 0ï¼Œ1 ä»£æ›¿
   ```

<br/>

##### åœ¨æ³¨è§£è·¯ç”±ä¸­ä½¿ç”¨èµ„æºè·¯ç”±

```php
use think\annotation\Route\Resource;

@Resource("blog")
  class Blog ...
```

<br/>

##### æ³¨è§£è·¯ç”±åˆ†ç»„

æ³¨è§£æ¨¡å¼ä¹Ÿæ”¯æŒåˆ†ç»„ï¼Œå…ˆè¦ use ç›¸å…³ç±»åº“ï¼Œç„¶åå£°æ˜ï¼›

```php
use think\annotation\Route;
use think\annotation\route\Group;

@Group("ads")
```

<br/>

---

<div STYLE="page-break-after: always;">
    <br>
    <br>
    <br>
    <br>
    <br></div>

## 6.10	URL ç”Ÿæˆ

##### åŸºæœ¬çš„URL ç”Ÿæˆæ–¹æ³•

1. åˆ›å»ºä¸€ä¸ªæ–°çš„æ§åˆ¶å™¨ `Url.class`ï¼Œåœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ªè·¯ç”±æ–¹æ³•å’Œ `URL` ç”Ÿæˆçš„æ–¹æ³•ï¼š

   ```php
   //è¿™ä¸¤ä¸ªæ–¹æ³•çš„å…·ä½“è·¯ç”±å¯¹åº”çš„è·¯ç”±
   Route::rule('ds', 'Url/index');
   Route::rule('ds/:id', 'Url/details');
   ```

2. ä½¿ç”¨ `Route::buildUrl('åœ°å€', [å‚æ•°]...)` æ¥è·å–è·¯ç”±çš„ `URL` åœ°å€ï¼š

   ```php
   return Route::buildUrl('Url/details', ['id'=>5]);
   ```

   æ³¨æ„ï¼Œè¿™é‡Œçš„åœ°å€å’Œè·¯ç”±çš„å®šä¹‰æ˜¯ç›¸å…³è”çš„ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰ï¼Œåœ°å€å°†ä¼šå˜åŒ–ã€‚

<br/>

##### é€šè¿‡è·¯ç”±çš„åˆ«åè¿”å› URL åœ°å€

3. å¯ä»¥ç»™è·¯ç”±å®šä¹‰å–ä¸€ä¸ªåˆ«åï¼Œç„¶ååœ¨ç”Ÿæˆ `URL` çš„æ—¶å€™ï¼Œç›´æ¥ä½¿ç”¨è¿™ä¸ªåˆ«åè°ƒç”¨ã€‚

   ```PHP
   Route::rule('ds/:id', 'Url/details')->name('u');
   ```

   ```php
   return Route::buildUrl('u', ['id'=>5]);
   ```

<br/>

##### ä½¿ç”¨è·¯ç”±åœ°å€ç›´æ¥ç”Ÿæˆ URL

â€‹	å¯ä»¥ç›´æ¥ä½¿ç”¨è·¯ç”±åœ°å€ç”Ÿæˆ `URL`ï¼Œä½†è¿™ä¸ªæ–¹å¼å¹¶ä¸éœ€è¦å’Œè·¯ç”±å®šä¹‰ç›¸åŒ¹é…ï¼š

```php
return Route::buildUrl('ds/5');
```

```php
//æ³¨æ„ï¼Œç”±äºï¼Œæˆ‘ä»¬é»˜è®¤åœ¨é…ç½®è®¾ç½®äº†åç¼€ä¸º.htmlï¼Œæ‰€ä»¥ï¼Œç”Ÿæˆçš„ URL ä¼šè‡ªåŠ¨åŠ ä¸Šï¼›
return Route::buildUrl('ds/5')->suffix('shtml');
```

<br/>

##### è¿”å›å®Œæ•´çš„åŸŸåè·¯å¾„

â€‹	å¦‚æœæƒ³è¦è¿”å›å®Œæ•´çš„åŸŸåè·¯å¾„ï¼Œå¯ä»¥å†æ·»åŠ  `domain()`ï¼š

```php
return Route::buildUrl('ds/5')->domain(true);
return Route::buildUrl('ds/5')->domain('news');
return Route::buildUrl('ds/5')->domain('news.abc.com');
return Route::buildUrl('ds/5@news.abc.com');
```

<br/>

##### ä½¿ç”¨åŠ©æ‰‹å‡½æ•° url() ç”Ÿæˆ URL

â€‹	ç›´æ¥ä½¿ç”¨åŠ©æ‰‹å‡½æ•° `url()` æ¥ä»£æ›¿ `Route::buildUrl()`:

```
return url('ds/5')
```

<br>

---

<div STYLE="page-break-after: always;">
    <br>
    <br>
    <br>
    <br>
    <br></div>
