## 5.9	数据库事务

##### 使用数据库事务的前提条件

- 数据库的表引擎必须是 **InnoDB**。

<br>

##### ThinkPHP 事务处理

- ThinkPHP 提供了两种事务处理方式：
  1. 自动处理，出错自动回滚；
  2. 手动处理，基本和原生处理类似，可以自行输出错误信息。

<br>

##### 例——自动事务处理

```php
Db::transaction(function () {
	Db::name('user')->where('id', 19)->save(['price'=>Db::raw('price - 3')]);
	Db::name('user1')->where('id', 20)->save(['price'=>Db::raw('price + 3')]);
});
```

<br>

##### 例——手动事务处理

```php
//启动事务
Db::startTrans();
try {
	Db::name('user')->where('id', 19)->save(['price'=>Db::raw('price - 3')]);
	Db::name('user1')->where('id', 20)->save(['price'=>Db::raw('price + 3')]);
	//提交事务
	Db::commit();
} catch (\Exception $e) {
	echo '执行 SQL 失败！';
	//回滚
	Db::rollback();
}
```

<br>

---

<div STYLE="page-break-after: always;"></div>

## 5.10	获取器与数据集处理

##### 获取器

- **说明**：获取器将数据的字段进行转换处理再进行操作。

- **例——使用获取器将获得得到所有字段转换为大写**

  ```php
  $user = Db::name('user')->withAttr('email', function ($value, $data) {
  	return strtoupper($value);
  })->select();
  	return json($user);
  ```

<br>

##### 数据集（❗待补充）

- **什么是数据集**： 数据集是从数据库中查询返回的结果集合，类型为 `think\Collection`。

- **数据集方法**：数据集提供了很多额外的方法，用于对数据集中的数据进行处理（其中部分类似于数据库方法，注意不要混淆）。

- **ThinkPHP 数据集方法一览表**：

  |      |      |      |
  | ---- | ---- | ---- |
  |      |      |      |
  |      |      |      |
  |      |      |      |

---

<div STYLE="page-break-after: always;"></div>

## 5.11	定义模型

##### 例——定义一个模型

```
class User extends Model{
}
```

- 

---

<div STYLE="page-break-after: always;"></div>